var BSON=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}for(var i=function(e){var t=p(e),r=t[0],n=t[1];return 3*(r+n)/4-n},o=function(e){var t,r,n=p(e),i=n[0],o=n[1],u=new a(function(e,t,r){return 3*(t+r)/4-r}(0,i,o)),s=0,l=o>0?i-4:i;for(r=0;r<l;r+=4)t=f[e.charCodeAt(r)]<<18|f[e.charCodeAt(r+1)]<<12|f[e.charCodeAt(r+2)]<<6|f[e.charCodeAt(r+3)],u[s++]=t>>16&255,u[s++]=t>>8&255,u[s++]=255&t;2===o&&(t=f[e.charCodeAt(r)]<<2|f[e.charCodeAt(r+1)]>>4,u[s++]=255&t);1===o&&(t=f[e.charCodeAt(r)]<<10|f[e.charCodeAt(r+1)]<<4|f[e.charCodeAt(r+2)]>>2,u[s++]=t>>8&255,u[s++]=255&t);return u},u=function(e){for(var t,r=e.length,n=r%3,i=[],o=16383,u=0,f=r-n;u<f;u+=o)i.push(d(e,u,u+o>f?f:u+o));1===n?(t=e[r-1],i.push(s[t>>2]+s[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],i.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return i.join("")},s=[],f=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=0,h=l.length;c<h;++c)s[c]=l[c],f[l.charCodeAt(c)]=c;function p(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function d(e,t,r){for(var n,i,o=[],u=t;u<r;u+=3)n=(e[u]<<16&16711680)+(e[u+1]<<8&65280)+(255&e[u+2]),o.push(s[(i=n)>>18&63]+s[i>>12&63]+s[i>>6&63]+s[63&i]);return o.join("")}f["-".charCodeAt(0)]=62,f["_".charCodeAt(0)]=63;var y={byteLength:i,toByteArray:o,fromByteArray:u},g=function(e,t,r,n,i){var o,u,s=8*i-n-1,f=(1<<s)-1,a=f>>1,l=-7,c=r?i-1:0,h=r?-1:1,p=e[t+c];for(c+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+c],c+=h,l-=8);for(u=o&(1<<-l)-1,o>>=-l,l+=n;l>0;u=256*u+e[t+c],c+=h,l-=8);if(0===o)o=1-a;else{if(o===f)return u?NaN:1/0*(p?-1:1);u+=Math.pow(2,n),o-=a}return(p?-1:1)*u*Math.pow(2,o-n)},_=function(e,t,r,n,i,o){var u,s,f,a=8*o-i-1,l=(1<<a)-1,c=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,u=l):(u=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-u))<1&&(u--,f*=2),(t+=u+c>=1?h/f:h*Math.pow(2,1-c))*f>=2&&(u++,f/=2),u+c>=l?(s=0,u=l):u+c>=1?(s=(t*f-1)*Math.pow(2,i),u+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),u=0));i>=8;e[r+p]=255&s,p+=d,s/=256,i-=8);for(u=u<<i|s,a+=i;a>0;e[r+p]=255&u,p+=d,u/=256,a-=8);e[r+p-d]|=128*y},b=n((function(e,t){var r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=Buffer,t.SlowBuffer=function(e){+e!=e&&(e=0);return Buffer.alloc(+e)},t.INSPECT_MAX_BYTES=50;var n=2147483647;function i(e){if(e>n)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,Buffer.prototype),t}function Buffer(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return s(e)}return o(e,t,r)}function o(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!Buffer.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|c(e,t),n=i(r),o=n.write(e,t);o!==r&&(n=n.slice(0,o));return n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(z(e,Uint8Array)){var t=new Uint8Array(e);return a(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(e));if(z(e,ArrayBuffer)||e&&z(e.buffer,ArrayBuffer))return a(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(z(e,SharedArrayBuffer)||e&&z(e.buffer,SharedArrayBuffer)))return a(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Buffer.from(n,t,r);var o=function(e){if(Buffer.isBuffer(e)){var t=0|l(e.length),r=i(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||$(e.length)?i(0):f(e);if("Buffer"===e.type&&Array.isArray(e.data))return f(e.data)}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Buffer.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(e))}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function s(e){return u(e),i(e<0?0:0|l(e))}function f(e){for(var t=e.length<0?0:0|l(e.length),r=i(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function a(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,Buffer.prototype),n}function l(e){if(e>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function c(e,t){if(Buffer.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||z(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(e));var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return P(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(e).length;default:if(i)return n?-1:P(e).length;t=(""+t).toLowerCase(),i=!0}}function h(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return D(this,t,r);case"utf8":case"utf-8":return A(this,t,r);case"ascii":return E(this,t,r);case"latin1":case"binary":return T(this,t,r);case"base64":return v(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function p(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function d(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),$(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=Buffer.from(t,n)),Buffer.isBuffer(t))return 0===t.length?-1:b(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):b(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,r,n,i){var o,u=1,s=e.length,f=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;u=2,s/=2,f/=2,r/=2}function a(e,t){return 1===u?e[t]:e.readUInt16BE(t*u)}if(i){var l=-1;for(o=r;o<s;o++)if(a(e,o)===a(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===f)return l*u}else-1!==l&&(o-=o-l),l=-1}else for(r+f>s&&(r=s-f),o=r;o>=0;o--){for(var c=!0,h=0;h<f;h++)if(a(e,o+h)!==a(t,h)){c=!1;break}if(c)return o}return-1}function B(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;n>o/2&&(n=o/2);for(var u=0;u<n;++u){var s=parseInt(t.substr(2*u,2),16);if($(s))return u;e[r+u]=s}return u}function O(e,t,r,n){return C(P(t,e.length-r),e,r,n)}function m(e,t,r,n){return C(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function S(e,t,r,n){return C(Y(t),e,r,n)}function N(e,t,r,n){return C(function(e,t){for(var r,n,i,o=[],u=0;u<e.length&&!((t-=2)<0);++u)n=(r=e.charCodeAt(u))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function v(e,t,r){return 0===t&&r===e.length?y.fromByteArray(e):y.fromByteArray(e.slice(t,r))}function A(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,u,s,f,a=e[i],l=null,c=a>239?4:a>223?3:a>191?2:1;if(i+c<=r)switch(c){case 1:a<128&&(l=a);break;case 2:128==(192&(o=e[i+1]))&&(f=(31&a)<<6|63&o)>127&&(l=f);break;case 3:o=e[i+1],u=e[i+2],128==(192&o)&&128==(192&u)&&(f=(15&a)<<12|(63&o)<<6|63&u)>2047&&(f<55296||f>57343)&&(l=f);break;case 4:o=e[i+1],u=e[i+2],s=e[i+3],128==(192&o)&&128==(192&u)&&128==(192&s)&&(f=(15&a)<<18|(63&o)<<12|(63&u)<<6|63&s)>65535&&f<1114112&&(l=f)}null===l?(l=65533,c=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=c}return function(e){var t=e.length;if(t<=w)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=w));return r}(n)}t.kMaxLength=n,Buffer.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),Buffer.poolSize=8192,Buffer.from=function(e,t,r){return o(e,t,r)},Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer,Uint8Array),Buffer.alloc=function(e,t,r){return function(e,t,r){return u(e),e<=0?i(e):void 0!==t?"string"==typeof r?i(e).fill(t,r):i(e).fill(t):i(e)}(e,t,r)},Buffer.allocUnsafe=function(e){return s(e)},Buffer.allocUnsafeSlow=function(e){return s(e)},Buffer.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==Buffer.prototype},Buffer.compare=function(e,t){if(z(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=Buffer.from(t,t.offset,t.byteLength)),!Buffer.isBuffer(e)||!Buffer.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Buffer.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Buffer.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(z(o,Uint8Array))i+o.length>n.length?Buffer.from(o).copy(n,i):Uint8Array.prototype.set.call(n,o,i);else{if(!Buffer.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i)}i+=o.length}return n},Buffer.byteLength=c,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)p(this,t,t+1);return this},Buffer.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)p(this,t,t+3),p(this,t+1,t+2);return this},Buffer.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)p(this,t,t+7),p(this,t+1,t+6),p(this,t+2,t+5),p(this,t+3,t+4);return this},Buffer.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):h.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(e){if(!Buffer.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Buffer.compare(this,e)},Buffer.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},r&&(Buffer.prototype[r]=Buffer.prototype.inspect),Buffer.prototype.compare=function(e,t,r,n,i){if(z(e,Uint8Array)&&(e=Buffer.from(e,e.offset,e.byteLength)),!Buffer.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(e));if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),u=(r>>>=0)-(t>>>=0),s=Math.min(o,u),f=this.slice(n,i),a=e.slice(t,r),l=0;l<s;++l)if(f[l]!==a[l]){o=f[l],u=a[l];break}return o<u?-1:u<o?1:0},Buffer.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Buffer.prototype.indexOf=function(e,t,r){return d(this,e,t,r,!0)},Buffer.prototype.lastIndexOf=function(e,t,r){return d(this,e,t,r,!1)},Buffer.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return B(this,e,t,r);case"utf8":case"utf-8":return O(this,e,t,r);case"ascii":case"latin1":case"binary":return m(this,e,t,r);case"base64":return S(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var w=4096;function E(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function T(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function D(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=k[e[o]];return i}function I(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length-1;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function x(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function U(e,t,r,n,i,o){if(!Buffer.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function R(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function L(e,t,r,n,i){return t=+t,r>>>=0,i||R(e,0,r,4),_(e,t,r,n,23,4),r+4}function j(e,t,r,n,i){return t=+t,r>>>=0,i||R(e,0,r,8),_(e,t,r,n,52,8),r+8}Buffer.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,Buffer.prototype),n},Buffer.prototype.readUintLE=Buffer.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},Buffer.prototype.readUintBE=Buffer.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},Buffer.prototype.readUint8=Buffer.prototype.readUInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),this[e]},Buffer.prototype.readUint16LE=Buffer.prototype.readUInt16LE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]|this[e+1]<<8},Buffer.prototype.readUint16BE=Buffer.prototype.readUInt16BE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]<<8|this[e+1]},Buffer.prototype.readUint32LE=Buffer.prototype.readUInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Buffer.prototype.readUint32BE=Buffer.prototype.readUInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Buffer.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},Buffer.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},Buffer.prototype.readInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Buffer.prototype.readInt16LE=function(e,t){e>>>=0,t||x(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(e,t){e>>>=0,t||x(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Buffer.prototype.readInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Buffer.prototype.readFloatLE=function(e,t){return e>>>=0,t||x(e,4,this.length),g(this,e,!0,23,4)},Buffer.prototype.readFloatBE=function(e,t){return e>>>=0,t||x(e,4,this.length),g(this,e,!1,23,4)},Buffer.prototype.readDoubleLE=function(e,t){return e>>>=0,t||x(e,8,this.length),g(this,e,!0,52,8)},Buffer.prototype.readDoubleBE=function(e,t){return e>>>=0,t||x(e,8,this.length),g(this,e,!1,52,8)},Buffer.prototype.writeUintLE=Buffer.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||U(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},Buffer.prototype.writeUintBE=Buffer.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t>>>=0,r>>>=0,n)||U(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},Buffer.prototype.writeUint8=Buffer.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,1,255,0),this[t]=255&e,t+1},Buffer.prototype.writeUint16LE=Buffer.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeUint16BE=Buffer.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeUint32LE=Buffer.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Buffer.prototype.writeUint32BE=Buffer.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);U(this,e,t,r,i-1,-i)}var o=0,u=1,s=0;for(this[t]=255&e;++o<r&&(u*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/u>>0)-s&255;return t+r},Buffer.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);U(this,e,t,r,i-1,-i)}var o=r-1,u=1,s=0;for(this[t+o]=255&e;--o>=0&&(u*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/u>>0)-s&255;return t+r},Buffer.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Buffer.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Buffer.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Buffer.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Buffer.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Buffer.prototype.writeFloatLE=function(e,t,r){return L(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return L(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return j(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return j(this,e,t,!1,r)},Buffer.prototype.copy=function(e,t,r,n){if(!Buffer.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},Buffer.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var u=Buffer.isBuffer(e)?e:Buffer.from(e,n),s=u.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(o=0;o<r-t;++o)this[o+t]=u[o%s]}return this};var M=/[^+/0-9A-Za-z-_]/g;function P(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],u=0;u<n;++u){if((r=e.charCodeAt(u))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(u+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Y(e){return y.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function $(e){return e!=e}var k=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()}));
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */b.Buffer,b.SlowBuffer,b.INSPECT_MAX_BYTES,b.kMaxLength;var B={},O="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},m=/%[sdj%]/g;function S(e){if(!j(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(A(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,i=n.length,o=String(e).replace(m,(function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}})),u=n[r];r<i;u=n[++r])R(u)||!Y(u)?o+=" "+u:o+=" "+A(u);return o}var N,v={};function A(e,t){var r={seen:[],stylize:E};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),U(t)?r.showHidden=t:t&&V(r,t),M(r.showHidden)&&(r.showHidden=!1),M(r.depth)&&(r.depth=2),M(r.colors)&&(r.colors=!1),M(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=w),T(r,e,r.depth)}function w(e,t){var r=A.styles[t];return r?"["+A.colors[r][0]+"m"+e+"["+A.colors[r][1]+"m":e}function E(e,t){return e}function T(e,t,r){if(e.customInspect&&t&&$(t.inspect)&&t.inspect!==A&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return j(n)||(n=T(e,n,r)),n}var i=function(e,t){if(M(t))return e.stylize("undefined","undefined");if(j(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(L(t))return e.stylize(""+t,"number");if(U(t))return e.stylize(""+t,"boolean");if(R(t))return e.stylize("null","null")}(e,t);if(i)return i;var o=Object.keys(t),u=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),z(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return D(t);if(0===o.length){if($(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(P(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(C(t))return e.stylize(Date.prototype.toString.call(t),"date");if(z(t))return D(t)}var f,a="",l=!1,c=["{","}"];(x(t)&&(l=!0,c=["[","]"]),$(t))&&(a=" [Function"+(t.name?": "+t.name:"")+"]");return P(t)&&(a=" "+RegExp.prototype.toString.call(t)),C(t)&&(a=" "+Date.prototype.toUTCString.call(t)),z(t)&&(a=" "+D(t)),0!==o.length||l&&0!=t.length?r<0?P(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),f=l?function(e,t,r,n,i){for(var o=[],u=0,s=t.length;u<s;++u)K(t,String(u))?o.push(I(e,t,r,n,String(u),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(I(e,t,r,n,i,!0))})),o}(e,t,r,u,o):o.map((function(n){return I(e,t,r,u,n,l)})),e.seen.pop(),function(e,t,r){if(e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(f,a,c)):c[0]+a+c[1]}function D(e){return"["+Error.prototype.toString.call(e)+"]"}function I(e,t,r,n,i,o){var u,s,f;if((f=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=f.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):f.set&&(s=e.stylize("[Setter]","special")),K(n,i)||(u="["+i+"]"),s||(e.seen.indexOf(f.value)<0?(s=R(r)?T(e,f.value,null):T(e,f.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),M(u)){if(o&&i.match(/^\d+$/))return s;(u=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(u=u.substr(1,u.length-2),u=e.stylize(u,"name")):(u=u.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),u=e.stylize(u,"string"))}return u+": "+s}function x(e){return Array.isArray(e)}function U(e){return"boolean"==typeof e}function R(e){return null===e}function L(e){return"number"==typeof e}function j(e){return"string"==typeof e}function M(e){return void 0===e}function P(e){return Y(e)&&"[object RegExp]"===k(e)}function Y(e){return"object"===babelHelpers.typeof(e)&&null!==e}function C(e){return Y(e)&&"[object Date]"===k(e)}function z(e){return Y(e)&&("[object Error]"===k(e)||e instanceof Error)}function $(e){return"function"==typeof e}function k(e){return Object.prototype.toString.call(e)}function J(e){return e<10?"0"+e.toString(10):e.toString(10)}A.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},A.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function F(){var e=new Date,t=[J(e.getHours()),J(e.getMinutes()),J(e.getSeconds())].join(":");return[e.getDate(),q[e.getMonth()],t].join(" ")}function V(e,t){if(!t||!Y(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function K(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var H={inherits:O,_extend:V,log:function(){console.log("%s - %s",F(),S.apply(null,arguments))},isBuffer:function(e){return Buffer.isBuffer(e)},isPrimitive:function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===babelHelpers.typeof(e)||void 0===e},isFunction:$,isError:z,isDate:C,isObject:Y,isRegExp:P,isUndefined:M,isSymbol:function(e){return"symbol"===babelHelpers.typeof(e)},isString:j,isNumber:L,isNullOrUndefined:function(e){return null==e},isNull:R,isBoolean:U,isArray:x,inspect:A,deprecate:function e(t,r){if(M(global.process))return function(){return e(t,r).apply(this,arguments)};var n=!1;return function(){return n||(console.error(r),n=!0),t.apply(this,arguments)}},format:S,debuglog:function(e){if(M(N)&&(N=""),e=e.toUpperCase(),!v[e])if(new RegExp("\\b"+e+"\\b","i").test(N)){v[e]=function(){var t=S.apply(null,arguments);console.error("%s %d: %s",e,0,t)}}else v[e]=function(){};return v[e]}},X=n((function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.deprecate=r.isObjectLike=r.isDate=r.isBuffer=r.haveBuffer=r.isBigUInt64Array=r.isBigInt64Array=r.isUint8Array=r.randomBytes=r.normalizedFunctionString=void 0,r.normalizedFunctionString=function(e){return e.toString().replace("function(","function (")};var n="object"==typeof t.navigator&&"ReactNative"===t.navigator.product?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.",i=function(e){console.warn(n);for(var t=b.Buffer.alloc(e),r=0;r<e;++r)t[r]=Math.floor(256*Math.random());return t};function o(e){return"object"==typeof e&&null!==e}r.randomBytes=function(){if("undefined"!=typeof window){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues)return function(t){return e.getRandomValues(b.Buffer.alloc(t))}}if(void 0!==t&&t.crypto&&t.crypto.getRandomValues)return function(e){return t.crypto.getRandomValues(b.Buffer.alloc(e))};var r;try{r=B.randomBytes}catch(e){}return r||i}(),r.isUint8Array=function(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)},r.isBigInt64Array=function(e){return"[object BigInt64Array]"===Object.prototype.toString.call(e)},r.isBigUInt64Array=function(e){return"[object BigUint64Array]"===Object.prototype.toString.call(e)},r.haveBuffer=function(){return void 0!==t&&void 0!==t.Buffer},r.isBuffer=function(e){var t;return"object"==typeof e&&"Buffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)},r.isDate=function(e){return o(e)&&"[object Date]"===Object.prototype.toString.call(e)},r.isObjectLike=o,r.deprecate=function(e,t){if("undefined"==typeof window&&"undefined"==typeof self)return H.deprecate(e,t);var r=!1;return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return r||(console.warn(t),r=!0),e.apply(this,n)}}}));r(X),X.deprecate,X.isObjectLike,X.isDate,X.isBuffer,X.haveBuffer,X.isBigUInt64Array,X.isBigInt64Array,X.isUint8Array,X.randomBytes,X.normalizedFunctionString;var W=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ensureBuffer=void 0,t.ensureBuffer=function(e){if(X.isBuffer(e))return e;if(ArrayBuffer.isView(e))return b.Buffer.from(e.buffer);if(e instanceof ArrayBuffer)return b.Buffer.from(e);throw new TypeError("Must use either Buffer or TypedArray")}}));r(W),W.ensureBuffer;var G=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.bufferToUuidHexString=t.uuidHexStringToBuffer=t.uuidValidateString=void 0;var r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i;t.uuidValidateString=function(e){return"string"==typeof e&&r.test(e)};t.uuidHexStringToBuffer=function(e){if(!t.uuidValidateString(e))throw new TypeError('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var r=e.replace(/-/g,"");return b.Buffer.from(r,"hex")};t.bufferToUuidHexString=function(e,t){return void 0===t&&(t=!0),t?e.toString("hex",0,4)+"-"+e.toString("hex",4,6)+"-"+e.toString("hex",6,8)+"-"+e.toString("hex",8,10)+"-"+e.toString("hex",10,16):e.toString("hex")}}));r(G),G.bufferToUuidHexString,G.uuidHexStringToBuffer,G.uuidValidateString;var Z=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=void 0;var r=Symbol("id"),n=function(){function e(t){if(void 0===t)this.id=e.generate();else if(t instanceof e)this[r]=b.Buffer.from(t.id),this.__id=t.__id;else if((b.Buffer.isBuffer(t)||ArrayBuffer.isView(t))&&16===t.byteLength)this.id=W.ensureBuffer(t);else{if("string"!=typeof t)throw new TypeError("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");this.id=G.uuidHexStringToBuffer(t)}}return Object.defineProperty(e.prototype,"id",{get:function(){return this[r]},set:function(t){this[r]=t,e.cacheHexString&&(this.__id=G.bufferToUuidHexString(t))},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(t){if(void 0===t&&(t=!0),e.cacheHexString&&this.__id)return this.__id;var r=G.bufferToUuidHexString(this.id,t);return e.cacheHexString&&(this.__id=r),r},e.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(!t)return!1;if(t instanceof e)return t.id.equals(this.id);try{return new e(t).id.equals(this.id)}catch(e){return!1}},e.prototype.toBinary=function(){return new Q.Binary(this.id,Q.Binary.SUBTYPE_UUID)},e.generate=function(){var e=X.randomBytes(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,b.Buffer.from(e)},e.isValid=function(t){if(!t)return!1;if(t instanceof e)return!0;if("string"==typeof t)return G.uuidValidateString(t);if(b.Buffer.isBuffer(t)){if(16!==t.length)return!1;try{return parseInt(t[6].toString(16)[0],10)===Q.Binary.SUBTYPE_UUID}catch(e){return!1}}return!1},e.createFromHexString=function(t){return new e(G.uuidHexStringToBuffer(t))},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new UUID("'+this.toHexString()+'")'},e}();t.UUID=n,Object.defineProperty(n.prototype,"_bsontype",{value:"UUID"})}));r(Z),Z.UUID;var Q=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Binary=void 0;var Binary=function(){function Binary(e,t){if(!(this instanceof Binary))return new Binary(e,t);if(!(null==e||"string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||Array.isArray(e)))throw new TypeError("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=null!=t?t:Binary.BSON_BINARY_SUBTYPE_DEFAULT,null==e?(this.buffer=b.Buffer.alloc(Binary.BUFFER_SIZE),this.position=0):("string"==typeof e?this.buffer=b.Buffer.from(e,"binary"):Array.isArray(e)?this.buffer=b.Buffer.from(e):this.buffer=W.ensureBuffer(e),this.position=this.buffer.byteLength)}return Binary.prototype.put=function(e){if("string"==typeof e&&1!==e.length)throw new TypeError("only accepts single character String");if("number"!=typeof e&&1!==e.length)throw new TypeError("only accepts single character Uint8Array or Array");var t;if((t="string"==typeof e?e.charCodeAt(0):"number"==typeof e?e:e[0])<0||t>255)throw new TypeError("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=t;else{var r=b.Buffer.alloc(Binary.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=t}},Binary.prototype.write=function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var r=b.Buffer.alloc(this.buffer.length+e.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r}ArrayBuffer.isView(e)?(this.buffer.set(W.ensureBuffer(e),t),this.position=t+e.byteLength>this.position?t+e.length:this.position):"string"==typeof e&&(this.buffer.write(e,t,e.length,"binary"),this.position=t+e.length>this.position?t+e.length:this.position)},Binary.prototype.read=function(e,t){return t=t&&t>0?t:this.position,this.buffer.slice(e,e+t)},Binary.prototype.value=function(e){return(e=!!e)&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},Binary.prototype.length=function(){return this.position},Binary.prototype.toJSON=function(){return this.buffer.toString("base64")},Binary.prototype.toString=function(e){return this.buffer.toString(e)},Binary.prototype.toExtendedJSON=function(e){e=e||{};var t=this.buffer.toString("base64"),r=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===r.length?"0"+r:r}:{$binary:{base64:t,subType:1===r.length?"0"+r:r}}},Binary.prototype.toUUID=function(){if(this.sub_type===Binary.SUBTYPE_UUID)return new Z.UUID(this.buffer.slice(0,this.position));throw new Error('Binary sub_type "'+this.sub_type+'" is not supported for converting to UUID. Only "'+Binary.SUBTYPE_UUID+'" is currently supported.')},Binary.fromExtendedJSON=function(e,t){var r,n;if(t=t||{},"$binary"in e?t.legacy&&"string"==typeof e.$binary&&"$type"in e?(n=e.$type?parseInt(e.$type,16):0,r=b.Buffer.from(e.$binary,"base64")):"string"!=typeof e.$binary&&(n=e.$binary.subType?parseInt(e.$binary.subType,16):0,r=b.Buffer.from(e.$binary.base64,"base64")):"$uuid"in e&&(n=4,r=G.uuidHexStringToBuffer(e.$uuid)),!r)throw new TypeError("Unexpected Binary Extended JSON format "+JSON.stringify(e));return new Binary(r,n)},Binary.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},Binary.prototype.inspect=function(){return'new Binary(Buffer.from("'+this.value(!0).toString("hex")+'", "hex"), '+this.sub_type+")"},Binary.BSON_BINARY_SUBTYPE_DEFAULT=0,Binary.BUFFER_SIZE=256,Binary.SUBTYPE_DEFAULT=0,Binary.SUBTYPE_FUNCTION=1,Binary.SUBTYPE_BYTE_ARRAY=2,Binary.SUBTYPE_UUID_OLD=3,Binary.SUBTYPE_UUID=4,Binary.SUBTYPE_MD5=5,Binary.SUBTYPE_USER_DEFINED=128,Binary}();t.Binary=Binary,Object.defineProperty(Binary.prototype,"_bsontype",{value:"Binary"})}));r(Q),Q.Binary;var ee=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Code=void 0;var r=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);this.code=t,this.scope=r}return e.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},e.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},e.fromExtendedJSON=function(t){return new e(t.$code,t.$scope)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.toJSON();return'new Code("'+e.code+'"'+(e.scope?", "+JSON.stringify(e.scope):"")+")"},e}();t.Code=r,Object.defineProperty(r.prototype,"_bsontype",{value:"Code"})}));r(ee),ee.Code;var te=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DBRef=t.isDBRefLike=void 0,t.isDBRefLike=function(e){return X.isObjectLike(e)&&null!=e.$id&&null!=e.$ref};var r=function(){function e(t,r,n,i){if(!(this instanceof e))return new e(t,r,n,i);var o=t.split(".");2===o.length&&(n=o.shift(),t=o.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=i||{}}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e},e.prototype.toExtendedJSON=function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy?t:(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields))},e.fromExtendedJSON=function(t){var r=Object.assign({},t);return delete r.$ref,delete r.$id,delete r.$db,new e(t.$ref,t.$id,t.$db,r)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return'new DBRef("'+this.namespace+'", new ObjectId("'+e+'")'+(this.db?', "'+this.db+'"':"")+")"},e}();t.DBRef=r,Object.defineProperty(r.prototype,"_bsontype",{value:"DBRef"})}));r(te),te.DBRef,te.isDBRefLike;var re=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Long=void 0;var r=void 0;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}var n=4294967296,i=0x10000000000000000,o=i/2,u={},s={},f=function(){function e(t,r,n){if(void 0===t&&(t=0),void 0===r&&(r=0),!(this instanceof e))return new e(t,r,n);this.low=0|t,this.high=0|r,this.unsigned=!!n,Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return e.fromBits=function(t,r,n){return new e(t,r,n)},e.fromInt=function(t,r){var n,i,o;return r?(o=0<=(t>>>=0)&&t<256)&&(i=s[t])?i:(n=e.fromBits(t,(0|t)<0?-1:0,!0),o&&(s[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(i=u[t])?i:(n=e.fromBits(t,t<0?-1:0,!1),o&&(u[t]=n),n)},e.fromNumber=function(t,r){if(isNaN(t))return r?e.UZERO:e.ZERO;if(r){if(t<0)return e.UZERO;if(t>=i)return e.MAX_UNSIGNED_VALUE}else{if(t<=-o)return e.MIN_VALUE;if(t+1>=o)return e.MAX_VALUE}return t<0?e.fromNumber(-t,r).neg():e.fromBits(t%n|0,t/n|0,r)},e.fromBigInt=function(t,r){return e.fromString(t.toString(),r)},e.fromString=function(t,r,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e.ZERO;if("number"==typeof r?(n=r,r=!1):r=!!r,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return e.fromString(t.substring(1),r,n).neg();for(var o=e.fromNumber(Math.pow(n,8)),u=e.ZERO,s=0;s<t.length;s+=8){var f=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+f),n);if(f<8){var l=e.fromNumber(Math.pow(n,f));u=u.mul(l).add(e.fromNumber(a))}else u=(u=u.mul(o)).add(e.fromNumber(a))}return u.unsigned=r,u},e.fromBytes=function(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.isLong=function(e){return X.isObjectLike(e)&&!0===e.__isLong__},e.fromValue=function(t,r){return"number"==typeof t?e.fromNumber(t,r):"string"==typeof t?e.fromString(t,r):e.fromBits(t.low,t.high,"boolean"==typeof r?r:t.unsigned)},e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,u=t.high>>>16,s=65535&t.high,f=t.low>>>16,a=0,l=0,c=0,h=0;return c+=(h+=o+(65535&t.low))>>>16,h&=65535,l+=(c+=i+f)>>>16,c&=65535,a+=(l+=n+s)>>>16,l&=65535,a+=r+u,a&=65535,e.fromBits(c<<16|h,a<<16|l,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},e.prototype.comp=function(e){return this.compare(e)},e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");if(r){if(!this.unsigned&&-2147483648===this.high&&-1===t.low&&-1===t.high)return this;var n=(this.unsigned?r.div_u:r.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(n,r.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var i,o,u;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;u=e.UZERO}else{if(this.eq(e.MIN_VALUE))return t.eq(e.ONE)||t.eq(e.NEG_ONE)?e.MIN_VALUE:t.eq(e.MIN_VALUE)?e.ONE:(i=this.shr(1).div(t).shl(1)).eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(o=this.sub(t.mul(i)),u=i.add(o.div(t)));if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();u=e.ZERO}for(o=this;o.gte(t);){i=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));for(var s=Math.ceil(Math.log(i)/Math.LN2),f=s<=48?1:Math.pow(2,s-48),a=e.fromNumber(i),l=a.mul(t);l.isNegative()||l.gt(o);)i-=f,l=(a=e.fromNumber(i,this.unsigned)).mul(t);a.isZero()&&(a=e.ONE),u=u.add(a),o=o.sub(l)}return u},e.prototype.div=function(e){return this.divide(e)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},e.prototype.eq=function(e){return this.equals(e)},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();var t,r=0!==this.high?this.high:this.low;for(t=31;t>0&&0==(r&1<<t);t--);return 0!==this.high?t+33:t+1},e.prototype.greaterThan=function(e){return this.comp(e)>0},e.prototype.gt=function(e){return this.greaterThan(e)},e.prototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},e.prototype.gte=function(e){return this.greaterThanOrEqual(e)},e.prototype.ge=function(e){return this.greaterThanOrEqual(e)},e.prototype.isEven=function(){return 0==(1&this.low)},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isOdd=function(){return 1==(1&this.low)},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isZero=function(){return 0===this.high&&0===this.low},e.prototype.lessThan=function(e){return this.comp(e)<0},e.prototype.lt=function(e){return this.lessThan(e)},e.prototype.lessThanOrEqual=function(e){return this.comp(e)<=0},e.prototype.lte=function(e){return this.lessThanOrEqual(e)},e.prototype.modulo=function(t){if(e.isLong(t)||(t=e.fromValue(t)),r){var n=(this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(n,r.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},e.prototype.mod=function(e){return this.modulo(e)},e.prototype.rem=function(e){return this.modulo(e)},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),r){var n=r.mul(this.low,this.high,t.low,t.high);return e.fromBits(n,r.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,o=65535&this.high,u=this.low>>>16,s=65535&this.low,f=t.high>>>16,a=65535&t.high,l=t.low>>>16,c=65535&t.low,h=0,p=0,d=0,y=0;return d+=(y+=s*c)>>>16,y&=65535,p+=(d+=u*c)>>>16,d&=65535,p+=(d+=s*l)>>>16,d&=65535,h+=(p+=o*c)>>>16,p&=65535,h+=(p+=u*l)>>>16,p&=65535,h+=(p+=s*a)>>>16,p&=65535,h+=i*c+o*l+u*a+s*f,h&=65535,e.fromBits(d<<16|y,h<<16|p,this.unsigned)},e.prototype.mul=function(e){return this.multiply(e)},e.prototype.negate=function(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=function(){return this.negate()},e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.notEquals=function(e){return!this.equals(e)},e.prototype.neq=function(e){return this.notEquals(e)},e.prototype.ne=function(e){return this.notEquals(e)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=function(e){return this.shiftLeft(e)},e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=function(e){return this.shiftRight(e)},e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),0===(t&=63))return this;var r=this.high;if(t<32){var n=this.low;return e.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}return 32===t?e.fromBits(r,0,this.unsigned):e.fromBits(r>>>t-32,0,this.unsigned)},e.prototype.shr_u=function(e){return this.shiftRightUnsigned(e)},e.prototype.shru=function(e){return this.shiftRightUnsigned(e)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())},e.prototype.sub=function(e){return this.subtract(e)},e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*n+(this.low>>>0):this.high*n+(this.low>>>0)},e.prototype.toBigInt=function(){return BigInt(this.toString())},e.prototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},e.prototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},e.prototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},e.prototype.toSigned=function(){return this.unsigned?e.fromBits(this.low,this.high,!1):this},e.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(e.MIN_VALUE)){var r=e.fromNumber(t),n=this.div(r),i=n.mul(r).sub(this);return n.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var o=e.fromNumber(Math.pow(t,6),this.unsigned),u=this,s="";;){var f=u.div(o),a=(u.sub(f.mul(o)).toInt()>>>0).toString(t);if((u=f).isZero())return a+s;for(;a.length<6;)a="0"+a;s=""+a+s}},e.prototype.toUnsigned=function(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.eqz=function(){return this.isZero()},e.prototype.le=function(e){return this.lessThanOrEqual(e)},e.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var n=e.fromString(t.$numberLong);return r&&r.relaxed?n.toNumber():n},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Long("'+this.toString()+'")'},e.TWO_PWR_24=e.fromInt(16777216),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e}();t.Long=f,Object.defineProperty(f.prototype,"__isLong__",{value:!0}),Object.defineProperty(f.prototype,"_bsontype",{value:"Long"})}));r(re),re.Long;var ne=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Decimal128=void 0;var r=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,n=/^(\+|-)?(Infinity|inf)$/i,i=/^(\+|-)?NaN$/i,o=6111,u=-6176,s=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),f=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),a=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),l=/^([-+])?(\d+)?$/;function c(e){return!isNaN(parseInt(e,10))}function h(e){var t=re.Long.fromNumber(1e9),r=re.Long.fromNumber(0);if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:r};for(var n=0;n<=3;n++)r=(r=r.shiftLeft(32)).add(new re.Long(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function p(e,t){throw new TypeError('"'+e+'" is not a valid Decimal128 string - '+t)}var d=function(){function e(t){if(!(this instanceof e))return new e(t);this.bytes=t}return e.fromString=function(t){var h,d=!1,y=!1,g=!1,_=0,B=0,O=0,m=0,S=0,N=[0],v=0,A=0,w=0,E=0,T=0,D=0,I=new re.Long(0,0),x=new re.Long(0,0),U=0;if(t.length>=7e3)throw new TypeError(t+" not a valid Decimal128 string");var R=t.match(r),L=t.match(n),j=t.match(i);if(!R&&!L&&!j||0===t.length)throw new TypeError(t+" not a valid Decimal128 string");if(R){var M=R[2],P=R[4],Y=R[5],C=R[6];P&&void 0===C&&p(t,"missing exponent power"),P&&void 0===M&&p(t,"missing exponent base"),void 0===P&&(Y||C)&&p(t,"missing e before exponent")}if("+"!==t[U]&&"-"!==t[U]||(d="-"===t[U++]),!c(t[U])&&"."!==t[U]){if("i"===t[U]||"I"===t[U])return new e(b.Buffer.from(d?f:a));if("N"===t[U])return new e(b.Buffer.from(s))}for(;c(t[U])||"."===t[U];)"."!==t[U]?(v<34&&("0"!==t[U]||g)&&(g||(S=B),g=!0,N[A++]=parseInt(t[U],10),v+=1),g&&(O+=1),y&&(m+=1),B+=1,U+=1):(y&&p(t,"contains multiple periods"),y=!0,U+=1);if(y&&!B)throw new TypeError(t+" not a valid Decimal128 string");if("e"===t[U]||"E"===t[U]){var z=t.substr(++U).match(l);if(!z||!z[2])return new e(b.Buffer.from(s));T=parseInt(z[0],10),U+=z[0].length}if(t[U])return new e(b.Buffer.from(s));if(w=0,v){if(E=v-1,1!==(_=O))for(;"0"===t[S+_-1];)_-=1}else w=0,E=0,N[0]=0,O=1,v=1,_=0;for(T<=m&&m-T>16384?T=u:T-=m;T>o;){if((E+=1)-w>34){if(N.join("").match(/^0+$/)){T=o;break}p(t,"overflow")}T-=1}for(;T<u||v<O;){if(0===E&&_<v){T=u,_=0;break}if(v<O?O-=1:E-=1,T<o)T+=1;else{if(N.join("").match(/^0+$/)){T=o;break}p(t,"overflow")}}if(E-w+1<_){var $=B;y&&(S+=1,$+=1),d&&(S+=1,$+=1);var k=parseInt(t[S+E+1],10),J=0;if(k>=5&&(J=1,5===k))for(J=N[E]%2==1?1:0,D=S+E+2;D<$;D++)if(parseInt(t[D],10)){J=1;break}if(J)for(var q=E;q>=0;q--)if(++N[q]>9&&(N[q]=0,0===q)){if(!(T<o))return new e(b.Buffer.from(d?f:a));T+=1,N[q]=1}}if(I=re.Long.fromNumber(0),x=re.Long.fromNumber(0),0===_)I=re.Long.fromNumber(0),x=re.Long.fromNumber(0);else if(E-w<17){q=w;for(x=re.Long.fromNumber(N[q++]),I=new re.Long(0,0);q<=E;q++)x=(x=x.multiply(re.Long.fromNumber(10))).add(re.Long.fromNumber(N[q]))}else{q=w;for(I=re.Long.fromNumber(N[q++]);q<=E-17;q++)I=(I=I.multiply(re.Long.fromNumber(10))).add(re.Long.fromNumber(N[q]));for(x=re.Long.fromNumber(N[q++]);q<=E;q++)x=(x=x.multiply(re.Long.fromNumber(10))).add(re.Long.fromNumber(N[q]))}var F,V,K,H,X=function(e,t){if(!e&&!t)return{high:re.Long.fromNumber(0),low:re.Long.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new re.Long(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new re.Long(t.getLowBits(),0),u=r.multiply(i),s=r.multiply(o),f=n.multiply(i),a=n.multiply(o);return u=u.add(s.shiftRightUnsigned(32)),s=new re.Long(s.getLowBits(),0).add(f).add(a.shiftRightUnsigned(32)),{high:u=u.add(s.shiftRightUnsigned(32)),low:a=s.shiftLeft(32).add(new re.Long(a.getLowBits(),0))}}(I,re.Long.fromString("100000000000000000"));X.low=X.low.add(x),F=X.low,V=x,K=F.high>>>0,H=V.high>>>0,(K<H||K===H&&F.low>>>0<V.low>>>0)&&(X.high=X.high.add(re.Long.fromNumber(1))),h=T+6176;var W={low:re.Long.fromNumber(0),high:re.Long.fromNumber(0)};X.high.shiftRightUnsigned(49).and(re.Long.fromNumber(1)).equals(re.Long.fromNumber(1))?(W.high=W.high.or(re.Long.fromNumber(3).shiftLeft(61)),W.high=W.high.or(re.Long.fromNumber(h).and(re.Long.fromNumber(16383).shiftLeft(47))),W.high=W.high.or(X.high.and(re.Long.fromNumber(0x7fffffffffff)))):(W.high=W.high.or(re.Long.fromNumber(16383&h).shiftLeft(49)),W.high=W.high.or(X.high.and(re.Long.fromNumber(562949953421311)))),W.low=X.low,d&&(W.high=W.high.or(re.Long.fromString("9223372036854775808")));var G=b.Buffer.alloc(16);return U=0,G[U++]=255&W.low.low,G[U++]=W.low.low>>8&255,G[U++]=W.low.low>>16&255,G[U++]=W.low.low>>24&255,G[U++]=255&W.low.high,G[U++]=W.low.high>>8&255,G[U++]=W.low.high>>16&255,G[U++]=W.low.high>>24&255,G[U++]=255&W.high.low,G[U++]=W.high.low>>8&255,G[U++]=W.high.low>>16&255,G[U++]=W.high.low>>24&255,G[U++]=255&W.high.high,G[U++]=W.high.high>>8&255,G[U++]=W.high.high>>16&255,G[U++]=W.high.high>>24&255,new e(G)},e.prototype.toString=function(){for(var e,t=0,r=new Array(36),n=0;n<r.length;n++)r[n]=0;var i,o,u,s=0,f=!1,a={parts:[0,0,0,0]},l=[];s=0;var c=this.bytes,p=c[s++]|c[s++]<<8|c[s++]<<16|c[s++]<<24,d=c[s++]|c[s++]<<8|c[s++]<<16|c[s++]<<24,y=c[s++]|c[s++]<<8|c[s++]<<16|c[s++]<<24,g=c[s++]|c[s++]<<8|c[s++]<<16|c[s++]<<24;s=0,{low:new re.Long(p,d),high:new re.Long(y,g)}.high.lessThan(re.Long.ZERO)&&l.push("-");var _=g>>26&31;if(_>>3==3){if(30===_)return l.join("")+"Infinity";if(31===_)return"NaN";e=g>>15&16383,i=8+(g>>14&1)}else i=g>>14&7,e=g>>17&16383;var b=e-6176;if(a.parts[0]=(16383&g)+((15&i)<<14),a.parts[1]=y,a.parts[2]=d,a.parts[3]=p,0===a.parts[0]&&0===a.parts[1]&&0===a.parts[2]&&0===a.parts[3])f=!0;else for(u=3;u>=0;u--){var B=0,O=h(a);if(a=O.quotient,B=O.rem.low)for(o=8;o>=0;o--)r[9*u+o]=B%10,B=Math.floor(B/10)}if(f)t=1,r[s]=0;else for(t=36;!r[s];)t-=1,s+=1;var m=t-1+b;if(m>=34||m<=-7||b>0){if(t>34)return l.push("0"),b>0?l.push("E+"+b):b<0&&l.push("E"+b),l.join("");l.push(""+r[s++]),(t-=1)&&l.push(".");for(n=0;n<t;n++)l.push(""+r[s++]);l.push("E"),m>0?l.push("+"+m):l.push(""+m)}else if(b>=0)for(n=0;n<t;n++)l.push(""+r[s++]);else{var S=t+b;if(S>0)for(n=0;n<S;n++)l.push(""+r[s++]);else l.push("0");for(l.push(".");S++<0;)l.push("0");for(n=0;n<t-Math.max(S-1,0);n++)l.push(""+r[s++])}return l.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'Decimal128.fromString("'+this.toString()+'")'},e}();t.Decimal128=d,Object.defineProperty(d.prototype,"_bsontype",{value:"Decimal128"})}));r(ne),ne.Decimal128;var ie=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Double=void 0;var r=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-"+this.value.toFixed(1)}:(Number.isInteger(this.value)?(t=this.value.toFixed(1)).length>=13&&(t=this.value.toExponential(13).toUpperCase()):t=this.value.toString(),{$numberDouble:t});var t},e.fromExtendedJSON=function(t,r){var n=parseFloat(t.$numberDouble);return r&&r.relaxed?n:new e(n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Double("+this.toExtendedJSON().$numberDouble+")"},e}();t.Double=r,Object.defineProperty(r.prototype,"_bsontype",{value:"Double"})}));r(ie),ie.Double;var oe=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Int32=void 0;var r=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}},e.fromExtendedJSON=function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Int32("+this.valueOf()+")"},e}();t.Int32=r,Object.defineProperty(r.prototype,"_bsontype",{value:"Int32"})}));r(oe),oe.Int32;var ue=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MaxKey=void 0;var r=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$maxKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MaxKey()"},e}();t.MaxKey=r,Object.defineProperty(r.prototype,"_bsontype",{value:"MaxKey"})}));r(ue),ue.MaxKey;var se=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MinKey=void 0;var r=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$minKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MinKey()"},e}();t.MinKey=r,Object.defineProperty(r.prototype,"_bsontype",{value:"MinKey"})}));r(se),se.MinKey;var fe=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectId=void 0;for(var r=X.randomBytes(5),n=new RegExp("^[0-9a-fA-F]{24}$"),i=[],o=0;o<256;o++)i[o]=(o<=15?"0":"")+o.toString(16);for(var u=[],s=0;s<10;)u[48+s]=s++;for(;s<16;)u[55+s]=u[87+s]=s++;var f=Symbol("id"),a=function(){function e(t){if(!(this instanceof e))return new e(t);if(t instanceof e&&(this[f]=t.id,this.__id=t.__id),"object"==typeof t&&t&&"id"in t&&("toHexString"in t&&"function"==typeof t.toHexString?this[f]=b.Buffer.from(t.toHexString(),"hex"):this[f]="string"==typeof t.id?b.Buffer.from(t.id):t.id),null!=t&&"number"!=typeof t||(this[f]=e.generate("number"==typeof t?t:void 0),e.cacheHexString&&(this.__id=this.id.toString("hex"))),ArrayBuffer.isView(t)&&12===t.byteLength&&(this[f]=W.ensureBuffer(t)),"string"==typeof t)if(12===t.length){var r=b.Buffer.from(t);12===r.byteLength&&(this[f]=r)}else{if(24!==t.length||!n.test(t))throw new TypeError("Argument passed in must be a Buffer or string of 12 bytes or a string of 24 hex characters");this[f]=b.Buffer.from(t,"hex")}e.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(e.prototype,"id",{get:function(){return this[f]},set:function(t){this[f]=t,e.cacheHexString&&(this.__id=t.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(e){this.id.writeUInt32BE(e,0)},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(){if(e.cacheHexString&&this.__id)return this.__id;var t=this.id.toString("hex");return e.cacheHexString&&!this.__id&&(this.__id=t),t},e.getInc=function(){return e.index=(e.index+1)%16777215},e.generate=function(t){"number"!=typeof t&&(t=~~(Date.now()/1e3));var n=e.getInc(),i=b.Buffer.alloc(12);return i.writeUInt32BE(t,0),i[4]=r[0],i[5]=r[1],i[6]=r[2],i[7]=r[3],i[8]=r[4],i[11]=255&n,i[10]=n>>8&255,i[9]=n>>16&255,i},e.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){return null!=t&&(t instanceof e?this.toString()===t.toString():"string"==typeof t&&e.isValid(t)&&12===t.length&&b.Buffer.isBuffer(this.id)?t===this.id.toString("binary"):"string"==typeof t&&e.isValid(t)&&24===t.length?t.toLowerCase()===this.toHexString():"string"==typeof t&&e.isValid(t)&&12===t.length?b.Buffer.from(t).equals(this.id):"object"==typeof t&&"toHexString"in t&&"function"==typeof t.toHexString&&t.toHexString()===this.toHexString())},e.prototype.getTimestamp=function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e},e.createPk=function(){return new e},e.createFromTime=function(t){var r=b.Buffer.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r.writeUInt32BE(t,0),new e(r)},e.createFromHexString=function(t){if(void 0===t||null!=t&&24!==t.length)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new e(b.Buffer.from(t,"hex"))},e.isValid=function(t){return null!=t&&("number"==typeof t||("string"==typeof t?12===t.length||24===t.length&&n.test(t):t instanceof e||(!(!b.Buffer.isBuffer(t)||12!==t.length)||"object"==typeof t&&"toHexString"in t&&"function"==typeof t.toHexString&&("string"==typeof t.id?12===t.id.length:24===t.toHexString().length&&n.test(t.id.toString("hex"))))))},e.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},e.fromExtendedJSON=function(t){return new e(t.$oid)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new ObjectId("'+this.toHexString()+'")'},e.index=~~(16777215*Math.random()),e}();t.ObjectId=a,Object.defineProperty(a.prototype,"generate",{value:X.deprecate((function(e){return a.generate(e)}),"Please use the static `ObjectId.generate(time)` instead")}),Object.defineProperty(a.prototype,"getInc",{value:X.deprecate((function(){return a.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(a.prototype,"get_inc",{value:X.deprecate((function(){return a.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(a,"get_inc",{value:X.deprecate((function(){return a.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(a.prototype,"_bsontype",{value:"ObjectID"})}));r(fe),fe.ObjectId;var ae=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BSONRegExp=void 0;var r=function(){function e(t,r){if(!(this instanceof e))return new e(t,r);this.pattern=t,this.options=null!=r?r:"",this.options.split("").sort().join("");for(var n=0;n<this.options.length;n++)if("i"!==this.options[n]&&"m"!==this.options[n]&&"x"!==this.options[n]&&"l"!==this.options[n]&&"s"!==this.options[n]&&"u"!==this.options[n])throw new Error("The regular expression option ["+this.options[n]+"] is not supported")}return e.parseOptions=function(e){return e?e.split("").sort().join(""):""},e.prototype.toExtendedJSON=function(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},e.fromExtendedJSON=function(t){if("$regex"in t){if("string"==typeof t.$regex)return new e(t.$regex,e.parseOptions(t.$options));if("BSONRegExp"===t.$regex._bsontype)return t}if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new TypeError("Unexpected BSONRegExp EJSON object form: "+JSON.stringify(t))},e}();t.BSONRegExp=r,Object.defineProperty(r.prototype,"_bsontype",{value:"BSONRegExp"})}));r(ae),ae.BSONRegExp;var le=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BSONSymbol=void 0;var r=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.value},e.prototype.inspect=function(){return'new BSONSymbol("'+this.value+'")'},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(){return{$symbol:this.value}},e.fromExtendedJSON=function(t){return new e(t.$symbol)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e}();t.BSONSymbol=r,Object.defineProperty(r.prototype,"_bsontype",{value:"Symbol"})}));r(le),le.BSONSymbol;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var ce=function(e,t){return ce=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},ce(e,t)};var he=function(){return he=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},he.apply(this,arguments)};function pe(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function de(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)u.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return u}function ye(e){return this instanceof ye?(this.v=e,this):new ye(e)}var ge=Object.freeze({__proto__:null,__extends:function(e,t){function r(){this.constructor=e}ce(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},get __assign(){return he},__rest:function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},__decorate:function(e,t,r,n){var i,o=arguments.length,u=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":babelHelpers.typeof(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(u=(o<3?i(u):o>3?i(t,r,u):i(t,r))||u);return o>3&&u&&Object.defineProperty(t,r,u),u},__param:function(e,t){return function(r,n){t(r,n,e)}},__metadata:function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":babelHelpers.typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function u(e){try{f(n.next(e))}catch(e){o(e)}}function s(e){try{f(n.throw(e))}catch(e){o(e)}}function f(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,s)}f((n=n.apply(e,t||[])).next())}))},__generator:function(e,t){var r,n,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,n=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},__createBinding:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},__exportStar:function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||(t[r]=e[r])},__values:pe,__read:de,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(de(arguments[t]));return e},__spreadArrays:function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],u=0,s=o.length;u<s;u++,i++)n[i]=o[u];return n},__await:ye,__asyncGenerator:function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},u("next"),u("throw"),u("return"),n[Symbol.asyncIterator]=function(){return this},n;function u(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||s(e,t)}))})}function s(e,t){try{(r=i[e](t)).value instanceof ye?Promise.resolve(r.value.v).then(f,a):l(o[0][2],r)}catch(e){l(o[0][3],e)}var r}function f(e){s("next",e)}function a(e){s("throw",e)}function l(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}},__asyncDelegator:function(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:ye(e[n](t)),done:"return"===n}:i?i(t):t}:i}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=pe(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},__importDefault:function(e){return e&&e.__esModule?e:{default:e}},__classPrivateFieldGet:function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet:function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}}),_e=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Timestamp=t.LongWithoutOverridesClass=void 0,t.LongWithoutOverridesClass=re.Long;var r=function(e){function t(r,n){var i=this;return i instanceof t?(i=re.Long.isLong(r)?e.call(this,r.low,r.high,!0)||this:e.call(this,r,n,!0)||this,Object.defineProperty(i,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),i):new t(r,n)}return ge.__extends(t,e),t.prototype.toJSON=function(){return{$timestamp:this.toString()}},t.fromInt=function(e){return new t(re.Long.fromInt(e,!0))},t.fromNumber=function(e){return new t(re.Long.fromNumber(e,!0))},t.fromBits=function(e,r){return new t(e,r)},t.fromString=function(e,r){return new t(re.Long.fromString(e,!0,r))},t.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},t.fromExtendedJSON=function(e){return new t(e.$timestamp.i,e.$timestamp.t)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Timestamp("+this.getLowBits().toString()+", "+this.getHighBits().toString()+")"},t.MAX_VALUE=re.Long.MAX_UNSIGNED_VALUE,t}(t.LongWithoutOverridesClass);t.Timestamp=r}));r(_e),_e.Timestamp,_e.LongWithoutOverridesClass;var be=n((function(e,t){function r(e){return X.isObjectLike(e)&&Reflect.has(e,"_bsontype")&&"string"==typeof e._bsontype}Object.defineProperty(t,"__esModule",{value:!0}),t.EJSON=t.isBSONType=void 0,t.isBSONType=r;var n=2147483647,i=-2147483648,o=0x8000000000000000,u=-0x8000000000000000,s={$oid:fe.ObjectId,$binary:Q.Binary,$uuid:Q.Binary,$symbol:le.BSONSymbol,$numberInt:oe.Int32,$numberDecimal:ne.Decimal128,$numberDouble:ie.Double,$numberLong:re.Long,$minKey:se.MinKey,$maxKey:ue.MaxKey,$regex:ae.BSONRegExp,$regularExpression:ae.BSONRegExp,$timestamp:_e.Timestamp};function f(e,t){if(void 0===t&&(t={}),"number"==typeof e){if(t.relaxed||t.legacy)return e;if(Math.floor(e)===e){if(e>=i&&e<=n)return new oe.Int32(e);if(e>=u&&e<=o)return re.Long.fromNumber(e)}return new ie.Double(e)}if(null==e||"object"!=typeof e)return e;if(e.$undefined)return null;for(var r=Object.keys(e).filter((function(t){return t.startsWith("$")&&null!=e[t]})),a=0;a<r.length;a++){var l=s[r[a]];if(l)return l.fromExtendedJSON(e,t)}if(null!=e.$date){var c=e.$date,h=new Date;return t.legacy?"number"==typeof c?h.setTime(c):"string"==typeof c&&h.setTime(Date.parse(c)):"string"==typeof c?h.setTime(Date.parse(c)):re.Long.isLong(c)?h.setTime(c.toNumber()):"number"==typeof c&&t.relaxed&&h.setTime(c),h}if(null!=e.$code){var p=Object.assign({},e);return e.$scope&&(p.$scope=f(e.$scope)),ee.Code.fromExtendedJSON(e)}if(null!=e.$ref||null!=e.$dbPointer){var d=e.$ref?e:e.$dbPointer;if(d instanceof te.DBRef)return d;var y=Object.keys(d).filter((function(e){return e.startsWith("$")})),g=!0;if(y.forEach((function(e){-1===["$ref","$id","$db"].indexOf(e)&&(g=!1)})),g)return te.DBRef.fromExtendedJSON(d)}return e}function a(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function l(e,t){if(Array.isArray(e))return function(e,t){return e.map((function(e){return l(e,t)}))}(e,t);if(void 0===e)return null;if(e instanceof Date){var s=e.getTime(),f=s>-1&&s<2534023188e5;return t.legacy?t.relaxed&&f?{$date:e.getTime()}:{$date:a(e)}:t.relaxed&&f?{$date:a(e)}:{$date:{$numberLong:e.getTime().toString()}}}if("number"==typeof e&&!t.relaxed){if(Math.floor(e)===e){var h=e>=u&&e<=o;if(e>=i&&e<=n)return{$numberInt:e.toString()};if(h)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp){var p=e.flags;if(void 0===p){var d=e.toString().match(/[gimuy]*$/);d&&(p=d[0])}return new ae.BSONRegExp(e.source,p).toExtendedJSON(t)}return null!=e&&"object"==typeof e?function(e,t){if(null==e||"object"!=typeof e)throw new Error("not an object instance");var n=e._bsontype;if(void 0===n){var i={};for(var o in e)i[o]=l(e[o],t);return i}if(r(e)){var u=e;if("function"!=typeof u.toExtendedJSON){var s=c[e._bsontype];if(!s)throw new TypeError("Unrecognized or invalid _bsontype: "+e._bsontype);u=s(u)}return"Code"===n&&u.scope?u=new ee.Code(u.code,l(u.scope,t)):"DBRef"===n&&u.oid&&(u=new te.DBRef(u.collection,l(u.oid,t),u.db,u.fields)),u.toExtendedJSON(t)}throw new Error("_bsontype must be a string, but was: "+typeof n)}(e,t):e}var c={Binary:function(e){return new Q.Binary(e.value(),e.sub_type)},Code:function(e){return new ee.Code(e.code,e.scope)},DBRef:function(e){return new te.DBRef(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new ne.Decimal128(e.bytes)},Double:function(e){return new ie.Double(e.value)},Int32:function(e){return new oe.Int32(e.value)},Long:function(e){return re.Long.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new ue.MaxKey},MinKey:function(){return new se.MinKey},ObjectID:function(e){return new fe.ObjectId(e)},ObjectId:function(e){return new fe.ObjectId(e)},BSONRegExp:function(e){return new ae.BSONRegExp(e.pattern,e.options)},Symbol:function(e){return new le.BSONSymbol(e.value)},Timestamp:function(e){return _e.Timestamp.fromBits(e.low,e.high)}};!function(e){function t(e,t){var r=Object.assign({},{relaxed:!0,legacy:!1},t);return"boolean"==typeof r.relaxed&&(r.strict=!r.relaxed),"boolean"==typeof r.strict&&(r.relaxed=!r.strict),JSON.parse(e,(function(e,t){return f(t,r)}))}function r(e,t,r,n){null!=r&&"object"==typeof r&&(n=r,r=0),null==t||"object"!=typeof t||Array.isArray(t)||(n=t,t=void 0,r=0);var i=l(e,n=Object.assign({},{relaxed:!0,legacy:!1},n));return JSON.stringify(i,t,r)}e.parse=t,e.stringify=r,e.serialize=function(e,t){return t=t||{},JSON.parse(r(e,t))},e.deserialize=function(e,r){return r=r||{},t(JSON.stringify(e),r)}}(t.EJSON||(t.EJSON={}))}));r(be),be.EJSON,be.isBSONType;var Be=n((function(e,r){var n;Object.defineProperty(r,"__esModule",{value:!0}),r.Map=void 0,r.Map=n;var i=function(e){return e&&e.Math==Math&&e};var o=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof t&&t)||Function("return this")();Object.prototype.hasOwnProperty.call(o,"Map")?r.Map=n=o.Map:r.Map=n=function(){function e(e){void 0===e&&(e=[]),this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var r=e[t],n=r[0],i=r[1];this._keys.push(n),this._values[n]={v:i,i:this._keys.length-1}}}return e.prototype.clear=function(){this._keys=[],this._values={}},e.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},e.prototype.entries=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:void 0!==r?[r,e._values[r].v]:void 0,done:void 0===r}}}},e.prototype.forEach=function(e,t){t=t||this;for(var r=0;r<this._keys.length;r++){var n=this._keys[r];e.call(t,this._values[n].v,n,t)}},e.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},e.prototype.has=function(e){return null!=this._values[e]},e.prototype.keys=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:void 0!==r?r:void 0,done:void 0===r}}}},e.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},e.prototype.values=function(){var e=this,t=0;return{next:function(){var r=e._keys[t++];return{value:void 0!==r?e._values[r].v:void 0,done:void 0===r}}}},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),e}()}));r(Be),Be.Map;var Oe=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BSON_BINARY_SUBTYPE_USER_DEFINED=t.BSON_BINARY_SUBTYPE_MD5=t.BSON_BINARY_SUBTYPE_UUID_NEW=t.BSON_BINARY_SUBTYPE_UUID=t.BSON_BINARY_SUBTYPE_BYTE_ARRAY=t.BSON_BINARY_SUBTYPE_FUNCTION=t.BSON_BINARY_SUBTYPE_DEFAULT=t.BSON_DATA_MAX_KEY=t.BSON_DATA_MIN_KEY=t.BSON_DATA_DECIMAL128=t.BSON_DATA_LONG=t.BSON_DATA_TIMESTAMP=t.BSON_DATA_INT=t.BSON_DATA_CODE_W_SCOPE=t.BSON_DATA_SYMBOL=t.BSON_DATA_CODE=t.BSON_DATA_DBPOINTER=t.BSON_DATA_REGEXP=t.BSON_DATA_NULL=t.BSON_DATA_DATE=t.BSON_DATA_BOOLEAN=t.BSON_DATA_OID=t.BSON_DATA_UNDEFINED=t.BSON_DATA_BINARY=t.BSON_DATA_ARRAY=t.BSON_DATA_OBJECT=t.BSON_DATA_STRING=t.BSON_DATA_NUMBER=t.JS_INT_MIN=t.JS_INT_MAX=t.BSON_INT64_MIN=t.BSON_INT64_MAX=t.BSON_INT32_MIN=t.BSON_INT32_MAX=void 0,t.BSON_INT32_MAX=2147483647,t.BSON_INT32_MIN=-2147483648,t.BSON_INT64_MAX=Math.pow(2,63)-1,t.BSON_INT64_MIN=-Math.pow(2,63),t.JS_INT_MAX=Math.pow(2,53),t.JS_INT_MIN=-Math.pow(2,53),t.BSON_DATA_NUMBER=1,t.BSON_DATA_STRING=2,t.BSON_DATA_OBJECT=3,t.BSON_DATA_ARRAY=4,t.BSON_DATA_BINARY=5,t.BSON_DATA_UNDEFINED=6,t.BSON_DATA_OID=7,t.BSON_DATA_BOOLEAN=8,t.BSON_DATA_DATE=9,t.BSON_DATA_NULL=10,t.BSON_DATA_REGEXP=11,t.BSON_DATA_DBPOINTER=12,t.BSON_DATA_CODE=13,t.BSON_DATA_SYMBOL=14,t.BSON_DATA_CODE_W_SCOPE=15,t.BSON_DATA_INT=16,t.BSON_DATA_TIMESTAMP=17,t.BSON_DATA_LONG=18,t.BSON_DATA_DECIMAL128=19,t.BSON_DATA_MIN_KEY=255,t.BSON_DATA_MAX_KEY=127,t.BSON_BINARY_SUBTYPE_DEFAULT=0,t.BSON_BINARY_SUBTYPE_FUNCTION=1,t.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,t.BSON_BINARY_SUBTYPE_UUID=3,t.BSON_BINARY_SUBTYPE_UUID_NEW=4,t.BSON_BINARY_SUBTYPE_MD5=5,t.BSON_BINARY_SUBTYPE_USER_DEFINED=128}));r(Oe),Oe.BSON_BINARY_SUBTYPE_USER_DEFINED,Oe.BSON_BINARY_SUBTYPE_MD5,Oe.BSON_BINARY_SUBTYPE_UUID_NEW,Oe.BSON_BINARY_SUBTYPE_UUID,Oe.BSON_BINARY_SUBTYPE_BYTE_ARRAY,Oe.BSON_BINARY_SUBTYPE_FUNCTION,Oe.BSON_BINARY_SUBTYPE_DEFAULT,Oe.BSON_DATA_MAX_KEY,Oe.BSON_DATA_MIN_KEY,Oe.BSON_DATA_DECIMAL128,Oe.BSON_DATA_LONG,Oe.BSON_DATA_TIMESTAMP,Oe.BSON_DATA_INT,Oe.BSON_DATA_CODE_W_SCOPE,Oe.BSON_DATA_SYMBOL,Oe.BSON_DATA_CODE,Oe.BSON_DATA_DBPOINTER,Oe.BSON_DATA_REGEXP,Oe.BSON_DATA_NULL,Oe.BSON_DATA_DATE,Oe.BSON_DATA_BOOLEAN,Oe.BSON_DATA_OID,Oe.BSON_DATA_UNDEFINED,Oe.BSON_DATA_BINARY,Oe.BSON_DATA_ARRAY,Oe.BSON_DATA_OBJECT,Oe.BSON_DATA_STRING,Oe.BSON_DATA_NUMBER,Oe.JS_INT_MIN,Oe.JS_INT_MAX,Oe.BSON_INT64_MIN,Oe.BSON_INT64_MAX,Oe.BSON_INT32_MIN,Oe.BSON_INT32_MAX;var me=n((function(e,t){function r(e,t,r){var i=5;if(Array.isArray(e))for(var o=0;o<e.length;o++)i+=n(o.toString(),e[o],t,!0,r);else for(var u in e.toBSON&&(e=e.toBSON()),e)i+=n(u,e[u],t,!1,r);return i}function n(e,t,n,i,o){switch(void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===o&&(o=!1),t&&t.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+b.Buffer.byteLength(e,"utf8")+1+4+b.Buffer.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=Oe.JS_INT_MIN&&t<=Oe.JS_INT_MAX&&t>=Oe.BSON_INT32_MIN&&t<=Oe.BSON_INT32_MAX?(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+5:(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+9;case"undefined":return i||!o?(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1;if("ObjectId"===t._bsontype||"ObjectID"===t._bsontype)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||X.isDate(t))return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+9;if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+6+t.byteLength;if("Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+9;if("Decimal128"===t._bsontype)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+17;if("Code"===t._bsontype)return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+4+4+b.Buffer.byteLength(t.code.toString(),"utf8")+1+r(t.scope,n,o):(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+4+b.Buffer.byteLength(t.code.toString(),"utf8")+1;if("Binary"===t._bsontype)return t.sub_type===Q.Binary.SUBTYPE_BYTE_ARRAY?(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if("Symbol"===t._bsontype)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+b.Buffer.byteLength(t.value,"utf8")+4+1+1;if("DBRef"===t._bsontype){var u=Object.assign({$ref:t.collection,$id:t.oid},t.fields);return null!=t.db&&(u.$db=t.db),(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+r(u,n,o)}return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)?(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+b.Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:"BSONRegExp"===t._bsontype?(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+b.Buffer.byteLength(t.pattern,"utf8")+1+b.Buffer.byteLength(t.options,"utf8")+1:(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+r(t,n,o)+1;case"function":if(t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)||"[object RegExp]"===String.call(t))return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+b.Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+4+4+b.Buffer.byteLength(X.normalizedFunctionString(t),"utf8")+1+r(t.scope,n,o);if(n)return(null!=e?b.Buffer.byteLength(e,"utf8")+1:0)+1+4+b.Buffer.byteLength(X.normalizedFunctionString(t),"utf8")+1}return 0}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateObjectSize=void 0,t.calculateObjectSize=r}));r(me),me.calculateObjectSize;var Se=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.validateUtf8=void 0;t.validateUtf8=function(e,t,r){for(var n=0,i=t;i<r;i+=1){var o=e[i];if(n){if(128!=(192&o))return!1;n-=1}else if(128&o)if(192==(224&o))n=1;else if(224==(240&o))n=2;else{if(240!=(248&o))return!1;n=3}}return!n}}));r(Se),Se.validateUtf8;var Ne=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=void 0;var r=re.Long.fromNumber(Oe.JS_INT_MAX),n=re.Long.fromNumber(Oe.JS_INT_MIN),i={};function o(e,t,s,f){void 0===f&&(f=!1);var a=null!=s.evalFunctions&&s.evalFunctions,l=null!=s.cacheFunctions&&s.cacheFunctions,c=null==s.fieldsAsRaw?null:s.fieldsAsRaw,h=null!=s.raw&&s.raw,p="boolean"==typeof s.bsonRegExp&&s.bsonRegExp,d=null!=s.promoteBuffers&&s.promoteBuffers,y=null==s.promoteLongs||s.promoteLongs,g=null==s.promoteValues||s.promoteValues,_=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var B=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(B<5||B>e.length)throw new Error("corrupt bson message");for(var O=f?[]:{},m=0;;){var S=e[t++];if(0===S)break;for(var N=t;0!==e[N]&&N<e.length;)N++;if(N>=e.byteLength)throw new Error("Bad BSON Document: illegal CString");var v=f?m++:e.toString("utf8",t,N);if(t=N+1,S===Oe.BSON_DATA_STRING){if((H=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||H>e.length-t||0!==e[t+H-1])throw new Error("bad string length in bson");if(!Se.validateUtf8(e,t,t+H-1))throw new Error("Invalid UTF-8 string in BSON document");var A=e.toString("utf8",t,t+H-1);O[v]=A,t+=H}else if(S===Oe.BSON_DATA_OID){var w=b.Buffer.alloc(12);e.copy(w,0,t,t+12),O[v]=new fe.ObjectId(w),t+=12}else if(S===Oe.BSON_DATA_INT&&!1===g)O[v]=new oe.Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(S===Oe.BSON_DATA_INT)O[v]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(S===Oe.BSON_DATA_NUMBER&&!1===g)O[v]=new ie.Double(e.readDoubleLE(t)),t+=8;else if(S===Oe.BSON_DATA_NUMBER)O[v]=e.readDoubleLE(t),t+=8;else if(S===Oe.BSON_DATA_DATE){var E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;O[v]=new Date(new re.Long(E,T).toNumber())}else if(S===Oe.BSON_DATA_BOOLEAN){if(0!==e[t]&&1!==e[t])throw new Error("illegal boolean type value");O[v]=1===e[t++]}else if(S===Oe.BSON_DATA_OBJECT){var D=t;if((V=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)<=0||V>e.length-t)throw new Error("bad embedded document length in bson");O[v]=h?e.slice(t,t+V):o(e,D,s,!1),t+=V}else if(S===Oe.BSON_DATA_ARRAY){D=t;var I=s,x=t+(V=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24);if(c&&c[v]){for(var U in I={},s)I[U]=s[U];I.raw=!0}if(O[v]=o(e,D,I,!0),0!==e[(t+=V)-1])throw new Error("invalid array terminator byte");if(t!==x)throw new Error("corrupted array bson")}else if(S===Oe.BSON_DATA_UNDEFINED)O[v]=void 0;else if(S===Oe.BSON_DATA_NULL)O[v]=null;else if(S===Oe.BSON_DATA_LONG){E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var R=new re.Long(E,T);O[v]=y&&!0===g&&R.lessThanOrEqual(r)&&R.greaterThanOrEqual(n)?R.toNumber():R}else if(S===Oe.BSON_DATA_DECIMAL128){var L=b.Buffer.alloc(16);e.copy(L,0,t,t+16),t+=16;var j=new ne.Decimal128(L);"toObject"in j&&"function"==typeof j.toObject?O[v]=j.toObject():O[v]=j}else if(S===Oe.BSON_DATA_BINARY){var M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,P=M,Y=e[t++];if(M<0)throw new Error("Negative binary type element size found");if(M>e.byteLength)throw new Error("Binary type size larger than document size");if(null!=e.slice){if(Y===Q.Binary.SUBTYPE_BYTE_ARRAY){if((M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(M>P-4)throw new Error("Binary type with subtype 0x02 contains too long binary size");if(M<P-4)throw new Error("Binary type with subtype 0x02 contains too short binary size")}O[v]=d&&g?e.slice(t,t+M):new Q.Binary(e.slice(t,t+M),Y)}else{var C=b.Buffer.alloc(M);if(Y===Q.Binary.SUBTYPE_BYTE_ARRAY){if((M=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(M>P-4)throw new Error("Binary type with subtype 0x02 contains too long binary size");if(M<P-4)throw new Error("Binary type with subtype 0x02 contains too short binary size")}for(N=0;N<M;N++)C[N]=e[t+N];O[v]=d&&g?C:new Q.Binary(C,Y)}t+=M}else if(S===Oe.BSON_DATA_REGEXP&&!1===p){for(N=t;0!==e[N]&&N<e.length;)N++;if(N>=e.length)throw new Error("Bad BSON Document: illegal CString");var z=e.toString("utf8",t,N);for(N=t=N+1;0!==e[N]&&N<e.length;)N++;if(N>=e.length)throw new Error("Bad BSON Document: illegal CString");var $=e.toString("utf8",t,N);t=N+1;var k=new Array($.length);for(N=0;N<$.length;N++)switch($[N]){case"m":k[N]="m";break;case"s":k[N]="g";break;case"i":k[N]="i"}O[v]=new RegExp(z,k.join(""))}else if(S===Oe.BSON_DATA_REGEXP&&!0===p){for(N=t;0!==e[N]&&N<e.length;)N++;if(N>=e.length)throw new Error("Bad BSON Document: illegal CString");z=e.toString("utf8",t,N);for(N=t=N+1;0!==e[N]&&N<e.length;)N++;if(N>=e.length)throw new Error("Bad BSON Document: illegal CString");$=e.toString("utf8",t,N);t=N+1,O[v]=new ae.BSONRegExp(z,$)}else if(S===Oe.BSON_DATA_SYMBOL){if((H=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||H>e.length-t||0!==e[t+H-1])throw new Error("bad string length in bson");var J=e.toString("utf8",t,t+H-1);O[v]=g?J:new le.BSONSymbol(J),t+=H}else if(S===Oe.BSON_DATA_TIMESTAMP){E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;O[v]=new _e.Timestamp(E,T)}else if(S===Oe.BSON_DATA_MIN_KEY)O[v]=new se.MinKey;else if(S===Oe.BSON_DATA_MAX_KEY)O[v]=new ue.MaxKey;else if(S===Oe.BSON_DATA_CODE){if((H=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||H>e.length-t||0!==e[t+H-1])throw new Error("bad string length in bson");var q=e.toString("utf8",t,t+H-1);O[v]=a?l?u(q,i,O):u(q):new ee.Code(q),t+=H}else if(S===Oe.BSON_DATA_CODE_W_SCOPE){var F=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(F<13)throw new Error("code_w_scope total size shorter minimum expected length");if((H=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||H>e.length-t||0!==e[t+H-1])throw new Error("bad string length in bson");q=e.toString("utf8",t,t+H-1),D=t+=H;var V=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,K=o(e,D,s,!1);if(t+=V,F<8+V+H)throw new Error("code_w_scope total size is too short, truncating scope");if(F>8+V+H)throw new Error("code_w_scope total size is too long, clips outer document");a?(O[v]=l?u(q,i,O):u(q),O[v].scope=K):O[v]=new ee.Code(q,K)}else{if(S!==Oe.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+S.toString(16)+' for fieldname "'+v+'"');var H;if((H=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||H>e.length-t||0!==e[t+H-1])throw new Error("bad string length in bson");if(!Se.validateUtf8(e,t,t+H-1))throw new Error("Invalid UTF-8 string in BSON document");var X=e.toString("utf8",t,t+H-1);t+=H;var W=b.Buffer.alloc(12);e.copy(W,0,t,t+12);w=new fe.ObjectId(W);t+=12,O[v]=new te.DBRef(X,w)}}if(B!==t-_){if(f)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}var G=Object.keys(O).filter((function(e){return e.startsWith("$")})),Z=!0;if(G.forEach((function(e){-1===["$ref","$id","$db"].indexOf(e)&&(Z=!1)})),!Z)return O;if(te.isDBRefLike(O)){var ce=Object.assign({},O);return delete ce.$ref,delete ce.$id,delete ce.$db,new te.DBRef(O.$ref,O.$id,O.$db,ce)}return O}function u(e,t,r){return t?(null==t[e]&&(t[e]=new Function(e)),t[e].bind(r)):new Function(e)}t.deserialize=function(e,t,r){var n=(t=null==t?{}:t)&&t.index?t.index:0,i=e[n]|e[n+1]<<8|e[n+2]<<16|e[n+3]<<24;if(i<5)throw new Error("bson size must be >= 5, is "+i);if(t.allowObjectSmallerThanBufferSize&&e.length<i)throw new Error("buffer length "+e.length+" must be >= bson size "+i);if(!t.allowObjectSmallerThanBufferSize&&e.length!==i)throw new Error("buffer length "+e.length+" must === bson size "+i);if(i+n>e.byteLength)throw new Error("(bson size "+i+" + options.index "+n+" must be <= buffer length "+e.byteLength+")");if(0!==e[n+i-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return o(e,n,t,r)}}));r(Ne),Ne.deserialize;var ve=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.writeIEEE754=t.readIEEE754=void 0,t.readIEEE754=function(e,t,r,n,i){var o,u,s="big"===r,f=8*i-n-1,a=(1<<f)-1,l=a>>1,c=-7,h=s?0:i-1,p=s?1:-1,d=e[t+h];for(h+=p,o=d&(1<<-c)-1,d>>=-c,c+=f;c>0;o=256*o+e[t+h],h+=p,c-=8);for(u=o&(1<<-c)-1,o>>=-c,c+=n;c>0;u=256*u+e[t+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===a)return u?NaN:1/0*(d?-1:1);u+=Math.pow(2,n),o-=l}return(d?-1:1)*u*Math.pow(2,o-n)},t.writeIEEE754=function(e,t,r,n,i,o){var u,s,f,a="big"===n,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=a?o-1:0,y=a?-1:1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,u=c):(u=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-u))<1&&(u--,f*=2),(t+=u+h>=1?p/f:p*Math.pow(2,1-h))*f>=2&&(u++,f/=2),u+h>=c?(s=0,u=c):u+h>=1?(s=(t*f-1)*Math.pow(2,i),u+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),u=0)),isNaN(t)&&(s=0);i>=8;)e[r+d]=255&s,d+=y,s/=256,i-=8;for(u=u<<i|s,isNaN(t)&&(u+=8),l+=i;l>0;)e[r+d]=255&u,d+=y,u/=256,l-=8;e[r+d-y]|=128*g}}));r(ve),ve.writeIEEE754,ve.readIEEE754;var Ae=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.serializeInto=void 0;var r=/\x00/,n=new Set(["$db","$ref","$id","$clusterTime"]);function i(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function o(e,t,r,n,i){e[n++]=Oe.BSON_DATA_STRING;var o=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8");e[(n=n+o+1)-1]=0;var u=e.write(r,n+4,void 0,"utf8");return e[n+3]=u+1>>24&255,e[n+2]=u+1>>16&255,e[n+1]=u+1>>8&255,e[n]=u+1&255,n=n+4+u,e[n++]=0,n}function u(e,t,r,n,i){Number.isInteger(r)&&r>=Oe.BSON_INT32_MIN&&r<=Oe.BSON_INT32_MAX?(e[n++]=Oe.BSON_DATA_INT,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,e[n++]=255&r,e[n++]=r>>8&255,e[n++]=r>>16&255,e[n++]=r>>24&255):(e[n++]=Oe.BSON_DATA_NUMBER,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,ve.writeIEEE754(e,r,n,"little",52,8),n+=8);return n}function s(e,t,r,n,i){return e[n++]=Oe.BSON_DATA_NULL,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,n}function f(e,t,r,n,i){return e[n++]=Oe.BSON_DATA_BOOLEAN,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,e[n++]=r?1:0,n}function a(e,t,r,n,i){e[n++]=Oe.BSON_DATA_DATE,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var o=re.Long.fromNumber(r.getTime()),u=o.getLowBits(),s=o.getHighBits();return e[n++]=255&u,e[n++]=u>>8&255,e[n++]=u>>16&255,e[n++]=u>>24&255,e[n++]=255&s,e[n++]=s>>8&255,e[n++]=s>>16&255,e[n++]=s>>24&255,n}function l(e,t,n,i,o){if(e[i++]=Oe.BSON_DATA_REGEXP,i+=o?e.write(t,i,void 0,"ascii"):e.write(t,i,void 0,"utf8"),e[i++]=0,n.source&&null!=n.source.match(r))throw Error("value "+n.source+" must not contain null bytes");return i+=e.write(n.source,i,void 0,"utf8"),e[i++]=0,n.ignoreCase&&(e[i++]=105),n.global&&(e[i++]=115),n.multiline&&(e[i++]=109),e[i++]=0,i}function c(e,t,n,i,o){if(e[i++]=Oe.BSON_DATA_REGEXP,i+=o?e.write(t,i,void 0,"ascii"):e.write(t,i,void 0,"utf8"),e[i++]=0,null!=n.pattern.match(r))throw Error("pattern "+n.pattern+" must not contain null bytes");return i+=e.write(n.pattern,i,void 0,"utf8"),e[i++]=0,i+=e.write(n.options.split("").sort().join(""),i,void 0,"utf8"),e[i++]=0,i}function h(e,t,r,n,i){return null===r?e[n++]=Oe.BSON_DATA_NULL:"MinKey"===r._bsontype?e[n++]=Oe.BSON_DATA_MIN_KEY:e[n++]=Oe.BSON_DATA_MAX_KEY,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,n}function p(e,t,r,n,i){if(e[n++]=Oe.BSON_DATA_OID,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,"string"==typeof r.id)e.write(r.id,n,void 0,"binary");else{if(!r.id||!r.id.copy)throw new TypeError("object ["+JSON.stringify(r)+"] is not a valid ObjectId");r.id.copy(e,n,0,12)}return n+12}function d(e,t,r,n,i){e[n++]=Oe.BSON_DATA_BINARY,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var o=r.length;return e[n++]=255&o,e[n++]=o>>8&255,e[n++]=o>>16&255,e[n++]=o>>24&255,e[n++]=Oe.BSON_BINARY_SUBTYPE_DEFAULT,e.set(W.ensureBuffer(r),n),n+=o}function y(e,t,r,n,i,o,u,s,f,a){void 0===i&&(i=!1),void 0===o&&(o=0),void 0===u&&(u=!1),void 0===s&&(s=!0),void 0===f&&(f=!1),void 0===a&&(a=[]);for(var l=0;l<a.length;l++)if(a[l]===r)throw new Error("cyclic dependency detected");a.push(r),e[n++]=Array.isArray(r)?Oe.BSON_DATA_ARRAY:Oe.BSON_DATA_OBJECT,n+=f?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var c=A(e,r,i,n,o+1,u,s,a);return a.pop(),c}function g(e,t,r,n,i){return e[n++]=Oe.BSON_DATA_DECIMAL128,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,r.bytes.copy(e,n,0,16),n+16}function _(e,t,r,n,i){e[n++]="Long"===r._bsontype?Oe.BSON_DATA_LONG:Oe.BSON_DATA_TIMESTAMP,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var o=r.getLowBits(),u=r.getHighBits();return e[n++]=255&o,e[n++]=o>>8&255,e[n++]=o>>16&255,e[n++]=o>>24&255,e[n++]=255&u,e[n++]=u>>8&255,e[n++]=u>>16&255,e[n++]=u>>24&255,n}function b(e,t,r,n,i){return r=r.valueOf(),e[n++]=Oe.BSON_DATA_INT,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,e[n++]=255&r,e[n++]=r>>8&255,e[n++]=r>>16&255,e[n++]=r>>24&255,n}function B(e,t,r,n,i){return e[n++]=Oe.BSON_DATA_NUMBER,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0,ve.writeIEEE754(e,r.value,n,"little",52,8),n+=8}function O(e,t,r,n,i,o,u){e[n++]=Oe.BSON_DATA_CODE,n+=u?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var s=X.normalizedFunctionString(r),f=e.write(s,n+4,void 0,"utf8")+1;return e[n]=255&f,e[n+1]=f>>8&255,e[n+2]=f>>16&255,e[n+3]=f>>24&255,n=n+4+f-1,e[n++]=0,n}function m(e,t,r,n,i,o,u,s,f){if(void 0===i&&(i=!1),void 0===o&&(o=0),void 0===u&&(u=!1),void 0===s&&(s=!0),void 0===f&&(f=!1),r.scope&&"object"==typeof r.scope){e[n++]=Oe.BSON_DATA_CODE_W_SCOPE,n+=f?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var a=n,l="string"==typeof r.code?r.code:r.code.toString();n+=4;var c=e.write(l,n+4,void 0,"utf8")+1;e[n]=255&c,e[n+1]=c>>8&255,e[n+2]=c>>16&255,e[n+3]=c>>24&255,e[n+4+c-1]=0,n=n+c+4;var h=A(e,r.scope,i,n,o+1,u,s);n=h-1;var p=h-a;e[a++]=255&p,e[a++]=p>>8&255,e[a++]=p>>16&255,e[a++]=p>>24&255,e[n++]=0}else{e[n++]=Oe.BSON_DATA_CODE,n+=f?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;l=r.code.toString();var d=e.write(l,n+4,void 0,"utf8")+1;e[n]=255&d,e[n+1]=d>>8&255,e[n+2]=d>>16&255,e[n+3]=d>>24&255,n=n+4+d-1,e[n++]=0}return n}function S(e,t,r,n,i){e[n++]=Oe.BSON_DATA_BINARY,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var o=r.value(!0),u=r.position;return r.sub_type===Q.Binary.SUBTYPE_BYTE_ARRAY&&(u+=4),e[n++]=255&u,e[n++]=u>>8&255,e[n++]=u>>16&255,e[n++]=u>>24&255,e[n++]=r.sub_type,r.sub_type===Q.Binary.SUBTYPE_BYTE_ARRAY&&(u-=4,e[n++]=255&u,e[n++]=u>>8&255,e[n++]=u>>16&255,e[n++]=u>>24&255),e.set(o,n),n+=r.position}function N(e,t,r,n,i){e[n++]=Oe.BSON_DATA_SYMBOL,n+=i?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var o=e.write(r.value,n+4,void 0,"utf8")+1;return e[n]=255&o,e[n+1]=o>>8&255,e[n+2]=o>>16&255,e[n+3]=o>>24&255,n=n+4+o-1,e[n++]=0,n}function v(e,t,r,n,i,o,u){e[n++]=Oe.BSON_DATA_OBJECT,n+=u?e.write(t,n,void 0,"ascii"):e.write(t,n,void 0,"utf8"),e[n++]=0;var s=n,f={$ref:r.collection||r.namespace,$id:r.oid};null!=r.db&&(f.$db=r.db);var a=A(e,f=Object.assign(f,r.fields),!1,n,i+1,o),l=a-s;return e[s++]=255&l,e[s++]=l>>8&255,e[s++]=l>>16&255,e[s++]=l>>24&255,a}function A(e,t,A,w,E,T,D,I){void 0===A&&(A=!1),void 0===w&&(w=0),void 0===E&&(E=0),void 0===T&&(T=!1),void 0===D&&(D=!0),void 0===I&&(I=[]),w=w||0,(I=I||[]).push(t);var x=w+4;if(Array.isArray(t))for(var U=0;U<t.length;U++){var R=""+U;if((Y=t[U])&&Y.toBSON){if("function"!=typeof Y.toBSON)throw new TypeError("toBSON is not a function");Y=Y.toBSON()}if("string"==typeof Y)x=o(e,R,Y,x,!0);else if("number"==typeof Y)x=u(e,R,Y,x,!0);else{if("bigint"==typeof Y)throw new TypeError("Unsupported type BigInt, please use Decimal128");if("boolean"==typeof Y)x=f(e,R,Y,x,!0);else if(Y instanceof Date||X.isDate(Y))x=a(e,R,Y,x,!0);else if(void 0===Y)x=s(e,R,0,x,!0);else if(null===Y)x=s(e,R,0,x,!0);else if("ObjectId"===Y._bsontype||"ObjectID"===Y._bsontype)x=p(e,R,Y,x,!0);else if(X.isBuffer(Y)||X.isUint8Array(Y))x=d(e,R,Y,x,!0);else if(Y instanceof RegExp||i(Y))x=l(e,R,Y,x,!0);else if("object"==typeof Y&&null==Y._bsontype)x=y(e,R,Y,x,A,E,T,D,!0,I);else if("object"==typeof Y&&be.isBSONType(Y)&&"Decimal128"===Y._bsontype)x=g(e,R,Y,x,!0);else if("Long"===Y._bsontype||"Timestamp"===Y._bsontype)x=_(e,R,Y,x,!0);else if("Double"===Y._bsontype)x=B(e,R,Y,x,!0);else if("function"==typeof Y&&T)x=O(e,R,Y,x,0,0,!0);else if("Code"===Y._bsontype)x=m(e,R,Y,x,A,E,T,D,!0);else if("Binary"===Y._bsontype)x=S(e,R,Y,x,!0);else if("Symbol"===Y._bsontype)x=N(e,R,Y,x,!0);else if("DBRef"===Y._bsontype)x=v(e,R,Y,x,E,T,!0);else if("BSONRegExp"===Y._bsontype)x=c(e,R,Y,x,!0);else if("Int32"===Y._bsontype)x=b(e,R,Y,x,!0);else if("MinKey"===Y._bsontype||"MaxKey"===Y._bsontype)x=h(e,R,Y,x,!0);else if(void 0!==Y._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+Y._bsontype)}}else if(t instanceof Be.Map)for(var L=t.entries(),j=!1;!j;){var M=L.next();if(!(j=!!M.done)){R=M.value[0];var P=typeof(Y=M.value[1]);if("string"==typeof R&&!n.has(R)){if(null!=R.match(r))throw Error("key "+R+" must not contain null bytes");if(A){if("$"===R[0])throw Error("key "+R+" must not start with '$'");if(~R.indexOf("."))throw Error("key "+R+" must not contain '.'")}}if("string"===P)x=o(e,R,Y,x);else if("number"===P)x=u(e,R,Y,x);else{if("bigint"===P||X.isBigInt64Array(Y)||X.isBigUInt64Array(Y))throw new TypeError("Unsupported type BigInt, please use Decimal128");if("boolean"===P)x=f(e,R,Y,x);else if(Y instanceof Date||X.isDate(Y))x=a(e,R,Y,x);else if(null===Y||void 0===Y&&!1===D)x=s(e,R,0,x);else if("ObjectId"===Y._bsontype||"ObjectID"===Y._bsontype)x=p(e,R,Y,x);else if(X.isBuffer(Y)||X.isUint8Array(Y))x=d(e,R,Y,x);else if(Y instanceof RegExp||i(Y))x=l(e,R,Y,x);else if("object"===P&&null==Y._bsontype)x=y(e,R,Y,x,A,E,T,D,!1,I);else if("object"===P&&"Decimal128"===Y._bsontype)x=g(e,R,Y,x);else if("Long"===Y._bsontype||"Timestamp"===Y._bsontype)x=_(e,R,Y,x);else if("Double"===Y._bsontype)x=B(e,R,Y,x);else if("Code"===Y._bsontype)x=m(e,R,Y,x,A,E,T,D);else if("function"==typeof Y&&T)x=O(e,R,Y,x,0,0,T);else if("Binary"===Y._bsontype)x=S(e,R,Y,x);else if("Symbol"===Y._bsontype)x=N(e,R,Y,x);else if("DBRef"===Y._bsontype)x=v(e,R,Y,x,E,T);else if("BSONRegExp"===Y._bsontype)x=c(e,R,Y,x);else if("Int32"===Y._bsontype)x=b(e,R,Y,x);else if("MinKey"===Y._bsontype||"MaxKey"===Y._bsontype)x=h(e,R,Y,x);else if(void 0!==Y._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+Y._bsontype)}}}else{if(t.toBSON){if("function"!=typeof t.toBSON)throw new TypeError("toBSON is not a function");if(null!=(t=t.toBSON())&&"object"!=typeof t)throw new TypeError("toBSON function did not return an object")}for(var R in t){var Y;if((Y=t[R])&&Y.toBSON){if("function"!=typeof Y.toBSON)throw new TypeError("toBSON is not a function");Y=Y.toBSON()}P=typeof Y;if("string"==typeof R&&!n.has(R)){if(null!=R.match(r))throw Error("key "+R+" must not contain null bytes");if(A){if("$"===R[0])throw Error("key "+R+" must not start with '$'");if(~R.indexOf("."))throw Error("key "+R+" must not contain '.'")}}if("string"===P)x=o(e,R,Y,x);else if("number"===P)x=u(e,R,Y,x);else{if("bigint"===P)throw new TypeError("Unsupported type BigInt, please use Decimal128");if("boolean"===P)x=f(e,R,Y,x);else if(Y instanceof Date||X.isDate(Y))x=a(e,R,Y,x);else if(void 0===Y)!1===D&&(x=s(e,R,0,x));else if(null===Y)x=s(e,R,0,x);else if("ObjectId"===Y._bsontype||"ObjectID"===Y._bsontype)x=p(e,R,Y,x);else if(X.isBuffer(Y)||X.isUint8Array(Y))x=d(e,R,Y,x);else if(Y instanceof RegExp||i(Y))x=l(e,R,Y,x);else if("object"===P&&null==Y._bsontype)x=y(e,R,Y,x,A,E,T,D,!1,I);else if("object"===P&&"Decimal128"===Y._bsontype)x=g(e,R,Y,x);else if("Long"===Y._bsontype||"Timestamp"===Y._bsontype)x=_(e,R,Y,x);else if("Double"===Y._bsontype)x=B(e,R,Y,x);else if("Code"===Y._bsontype)x=m(e,R,Y,x,A,E,T,D);else if("function"==typeof Y&&T)x=O(e,R,Y,x,0,0,T);else if("Binary"===Y._bsontype)x=S(e,R,Y,x);else if("Symbol"===Y._bsontype)x=N(e,R,Y,x);else if("DBRef"===Y._bsontype)x=v(e,R,Y,x,E,T);else if("BSONRegExp"===Y._bsontype)x=c(e,R,Y,x);else if("Int32"===Y._bsontype)x=b(e,R,Y,x);else if("MinKey"===Y._bsontype||"MaxKey"===Y._bsontype)x=h(e,R,Y,x);else if(void 0!==Y._bsontype)throw new TypeError("Unrecognized or invalid _bsontype: "+Y._bsontype)}}}I.pop(),e[x++]=0;var C=x-w;return e[w++]=255&C,e[w++]=C>>8&255,e[w++]=C>>16&255,e[w++]=C>>24&255,x}t.serializeInto=A}));r(Ae),Ae.serializeInto;var we=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectID=t.Decimal128=t.BSONRegExp=t.MaxKey=t.MinKey=t.Int32=t.Double=t.Timestamp=t.Long=t.UUID=t.ObjectId=t.Binary=t.DBRef=t.BSONSymbol=t.Map=t.Code=t.LongWithoutOverridesClass=t.EJSON=t.BSON_INT64_MIN=t.BSON_INT64_MAX=t.BSON_INT32_MIN=t.BSON_INT32_MAX=t.BSON_DATA_UNDEFINED=t.BSON_DATA_TIMESTAMP=t.BSON_DATA_SYMBOL=t.BSON_DATA_STRING=t.BSON_DATA_REGEXP=t.BSON_DATA_OID=t.BSON_DATA_OBJECT=t.BSON_DATA_NUMBER=t.BSON_DATA_NULL=t.BSON_DATA_MIN_KEY=t.BSON_DATA_MAX_KEY=t.BSON_DATA_LONG=t.BSON_DATA_INT=t.BSON_DATA_DECIMAL128=t.BSON_DATA_DBPOINTER=t.BSON_DATA_DATE=t.BSON_DATA_CODE_W_SCOPE=t.BSON_DATA_CODE=t.BSON_DATA_BOOLEAN=t.BSON_DATA_BINARY=t.BSON_DATA_ARRAY=t.BSON_BINARY_SUBTYPE_UUID_NEW=t.BSON_BINARY_SUBTYPE_UUID=t.BSON_BINARY_SUBTYPE_USER_DEFINED=t.BSON_BINARY_SUBTYPE_MD5=t.BSON_BINARY_SUBTYPE_FUNCTION=t.BSON_BINARY_SUBTYPE_DEFAULT=t.BSON_BINARY_SUBTYPE_BYTE_ARRAY=void 0,t.deserializeStream=t.calculateObjectSize=t.deserialize=t.serializeWithBufferAndIndex=t.serialize=t.setInternalBufferSize=void 0,Object.defineProperty(t,"Binary",{enumerable:!0,get:function(){return Q.Binary}}),Object.defineProperty(t,"Code",{enumerable:!0,get:function(){return ee.Code}}),Object.defineProperty(t,"DBRef",{enumerable:!0,get:function(){return te.DBRef}}),Object.defineProperty(t,"Decimal128",{enumerable:!0,get:function(){return ne.Decimal128}}),Object.defineProperty(t,"Double",{enumerable:!0,get:function(){return ie.Double}}),Object.defineProperty(t,"Int32",{enumerable:!0,get:function(){return oe.Int32}}),Object.defineProperty(t,"Long",{enumerable:!0,get:function(){return re.Long}}),Object.defineProperty(t,"Map",{enumerable:!0,get:function(){return Be.Map}}),Object.defineProperty(t,"MaxKey",{enumerable:!0,get:function(){return ue.MaxKey}}),Object.defineProperty(t,"MinKey",{enumerable:!0,get:function(){return se.MinKey}}),Object.defineProperty(t,"ObjectId",{enumerable:!0,get:function(){return fe.ObjectId}}),Object.defineProperty(t,"ObjectID",{enumerable:!0,get:function(){return fe.ObjectId}}),Object.defineProperty(t,"BSONRegExp",{enumerable:!0,get:function(){return ae.BSONRegExp}}),Object.defineProperty(t,"BSONSymbol",{enumerable:!0,get:function(){return le.BSONSymbol}}),Object.defineProperty(t,"Timestamp",{enumerable:!0,get:function(){return _e.Timestamp}}),Object.defineProperty(t,"UUID",{enumerable:!0,get:function(){return Z.UUID}}),Object.defineProperty(t,"BSON_BINARY_SUBTYPE_BYTE_ARRAY",{enumerable:!0,get:function(){return Oe.BSON_BINARY_SUBTYPE_BYTE_ARRAY}}),Object.defineProperty(t,"BSON_BINARY_SUBTYPE_DEFAULT",{enumerable:!0,get:function(){return Oe.BSON_BINARY_SUBTYPE_DEFAULT}}),Object.defineProperty(t,"BSON_BINARY_SUBTYPE_FUNCTION",{enumerable:!0,get:function(){return Oe.BSON_BINARY_SUBTYPE_FUNCTION}}),Object.defineProperty(t,"BSON_BINARY_SUBTYPE_MD5",{enumerable:!0,get:function(){return Oe.BSON_BINARY_SUBTYPE_MD5}}),Object.defineProperty(t,"BSON_BINARY_SUBTYPE_USER_DEFINED",{enumerable:!0,get:function(){return Oe.BSON_BINARY_SUBTYPE_USER_DEFINED}}),Object.defineProperty(t,"BSON_BINARY_SUBTYPE_UUID",{enumerable:!0,get:function(){return Oe.BSON_BINARY_SUBTYPE_UUID}}),Object.defineProperty(t,"BSON_BINARY_SUBTYPE_UUID_NEW",{enumerable:!0,get:function(){return Oe.BSON_BINARY_SUBTYPE_UUID_NEW}}),Object.defineProperty(t,"BSON_DATA_ARRAY",{enumerable:!0,get:function(){return Oe.BSON_DATA_ARRAY}}),Object.defineProperty(t,"BSON_DATA_BINARY",{enumerable:!0,get:function(){return Oe.BSON_DATA_BINARY}}),Object.defineProperty(t,"BSON_DATA_BOOLEAN",{enumerable:!0,get:function(){return Oe.BSON_DATA_BOOLEAN}}),Object.defineProperty(t,"BSON_DATA_CODE",{enumerable:!0,get:function(){return Oe.BSON_DATA_CODE}}),Object.defineProperty(t,"BSON_DATA_CODE_W_SCOPE",{enumerable:!0,get:function(){return Oe.BSON_DATA_CODE_W_SCOPE}}),Object.defineProperty(t,"BSON_DATA_DATE",{enumerable:!0,get:function(){return Oe.BSON_DATA_DATE}}),Object.defineProperty(t,"BSON_DATA_DBPOINTER",{enumerable:!0,get:function(){return Oe.BSON_DATA_DBPOINTER}}),Object.defineProperty(t,"BSON_DATA_DECIMAL128",{enumerable:!0,get:function(){return Oe.BSON_DATA_DECIMAL128}}),Object.defineProperty(t,"BSON_DATA_INT",{enumerable:!0,get:function(){return Oe.BSON_DATA_INT}}),Object.defineProperty(t,"BSON_DATA_LONG",{enumerable:!0,get:function(){return Oe.BSON_DATA_LONG}}),Object.defineProperty(t,"BSON_DATA_MAX_KEY",{enumerable:!0,get:function(){return Oe.BSON_DATA_MAX_KEY}}),Object.defineProperty(t,"BSON_DATA_MIN_KEY",{enumerable:!0,get:function(){return Oe.BSON_DATA_MIN_KEY}}),Object.defineProperty(t,"BSON_DATA_NULL",{enumerable:!0,get:function(){return Oe.BSON_DATA_NULL}}),Object.defineProperty(t,"BSON_DATA_NUMBER",{enumerable:!0,get:function(){return Oe.BSON_DATA_NUMBER}}),Object.defineProperty(t,"BSON_DATA_OBJECT",{enumerable:!0,get:function(){return Oe.BSON_DATA_OBJECT}}),Object.defineProperty(t,"BSON_DATA_OID",{enumerable:!0,get:function(){return Oe.BSON_DATA_OID}}),Object.defineProperty(t,"BSON_DATA_REGEXP",{enumerable:!0,get:function(){return Oe.BSON_DATA_REGEXP}}),Object.defineProperty(t,"BSON_DATA_STRING",{enumerable:!0,get:function(){return Oe.BSON_DATA_STRING}}),Object.defineProperty(t,"BSON_DATA_SYMBOL",{enumerable:!0,get:function(){return Oe.BSON_DATA_SYMBOL}}),Object.defineProperty(t,"BSON_DATA_TIMESTAMP",{enumerable:!0,get:function(){return Oe.BSON_DATA_TIMESTAMP}}),Object.defineProperty(t,"BSON_DATA_UNDEFINED",{enumerable:!0,get:function(){return Oe.BSON_DATA_UNDEFINED}}),Object.defineProperty(t,"BSON_INT32_MAX",{enumerable:!0,get:function(){return Oe.BSON_INT32_MAX}}),Object.defineProperty(t,"BSON_INT32_MIN",{enumerable:!0,get:function(){return Oe.BSON_INT32_MIN}}),Object.defineProperty(t,"BSON_INT64_MAX",{enumerable:!0,get:function(){return Oe.BSON_INT64_MAX}}),Object.defineProperty(t,"BSON_INT64_MIN",{enumerable:!0,get:function(){return Oe.BSON_INT64_MIN}});var r=be;Object.defineProperty(t,"EJSON",{enumerable:!0,get:function(){return r.EJSON}});var n=_e;Object.defineProperty(t,"LongWithoutOverridesClass",{enumerable:!0,get:function(){return n.LongWithoutOverridesClass}});var i=17825792,o=b.Buffer.alloc(i);function u(e){o.length<e&&(o=b.Buffer.alloc(e))}function s(e,t){void 0===t&&(t={});var r="boolean"==typeof t.checkKeys&&t.checkKeys,n="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,u="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,s="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:i;o.length<s&&(o=b.Buffer.alloc(s));var f=Ae.serializeInto(o,e,r,0,0,n,u,[]),a=b.Buffer.alloc(f);return o.copy(a,0,0,a.length),a}function f(e,t,r){void 0===r&&(r={});var n="boolean"==typeof r.checkKeys&&r.checkKeys,i="boolean"==typeof r.serializeFunctions&&r.serializeFunctions,u="boolean"!=typeof r.ignoreUndefined||r.ignoreUndefined,s="number"==typeof r.index?r.index:0,f=Ae.serializeInto(o,e,n,0,0,i,u);return o.copy(t,s,0,f),s+f-1}function a(e,t){return void 0===t&&(t={}),Ne.deserialize(W.ensureBuffer(e),t)}function l(e,t){void 0===t&&(t={});var r="boolean"==typeof(t=t||{}).serializeFunctions&&t.serializeFunctions,n="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return me.calculateObjectSize(e,r,n)}function c(e,t,r,n,i,o){for(var u=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},o),s=W.ensureBuffer(e),f=t,a=0;a<r;a++){var l=s[f]|s[f+1]<<8|s[f+2]<<16|s[f+3]<<24;u.index=f,n[i+a]=Ne.deserialize(s,u),f+=l}return f}t.setInternalBufferSize=u,t.serialize=s,t.serializeWithBufferAndIndex=f,t.deserialize=a,t.calculateObjectSize=l,t.deserializeStream=c;var h={Binary:Q.Binary,Code:ee.Code,DBRef:te.DBRef,Decimal128:ne.Decimal128,Double:ie.Double,Int32:oe.Int32,Long:re.Long,UUID:Z.UUID,Map:Be.Map,MaxKey:ue.MaxKey,MinKey:se.MinKey,ObjectId:fe.ObjectId,ObjectID:fe.ObjectId,BSONRegExp:ae.BSONRegExp,BSONSymbol:le.BSONSymbol,Timestamp:_e.Timestamp,EJSON:be.EJSON,setInternalBufferSize:u,serialize:s,serializeWithBufferAndIndex:f,deserialize:a,calculateObjectSize:l,deserializeStream:c};t.default=h})),Ee=r(we),Te=we.ObjectID,De=we.Decimal128,Ie=we.BSONRegExp,xe=we.MaxKey,Ue=we.MinKey,Re=we.Int32,Le=we.Double,je=we.Timestamp,Me=we.Long,Pe=we.UUID,Ye=we.ObjectId,Ce=we.Binary,ze=we.DBRef,$e=we.BSONSymbol,ke=we.Map,Je=we.Code,qe=we.LongWithoutOverridesClass,Fe=we.EJSON,Ve=we.BSON_INT64_MIN,Ke=we.BSON_INT64_MAX,He=we.BSON_INT32_MIN,Xe=we.BSON_INT32_MAX,We=we.BSON_DATA_UNDEFINED,Ge=we.BSON_DATA_TIMESTAMP,Ze=we.BSON_DATA_SYMBOL,Qe=we.BSON_DATA_STRING,et=we.BSON_DATA_REGEXP,tt=we.BSON_DATA_OID,rt=we.BSON_DATA_OBJECT,nt=we.BSON_DATA_NUMBER,it=we.BSON_DATA_NULL,ot=we.BSON_DATA_MIN_KEY,ut=we.BSON_DATA_MAX_KEY,st=we.BSON_DATA_LONG,ft=we.BSON_DATA_INT,at=we.BSON_DATA_DECIMAL128,lt=we.BSON_DATA_DBPOINTER,ct=we.BSON_DATA_DATE,ht=we.BSON_DATA_CODE_W_SCOPE,pt=we.BSON_DATA_CODE,dt=we.BSON_DATA_BOOLEAN,yt=we.BSON_DATA_BINARY,gt=we.BSON_DATA_ARRAY,_t=we.BSON_BINARY_SUBTYPE_UUID_NEW,bt=we.BSON_BINARY_SUBTYPE_UUID,Bt=we.BSON_BINARY_SUBTYPE_USER_DEFINED,Ot=we.BSON_BINARY_SUBTYPE_MD5,mt=we.BSON_BINARY_SUBTYPE_FUNCTION,St=we.BSON_BINARY_SUBTYPE_DEFAULT,Nt=we.BSON_BINARY_SUBTYPE_BYTE_ARRAY,vt=we.deserializeStream,At=we.calculateObjectSize,wt=we.deserialize,Et=we.serializeWithBufferAndIndex,Tt=we.serialize,Dt=we.setInternalBufferSize;return e.BSONRegExp=Ie,e.BSONSymbol=$e,e.BSON_BINARY_SUBTYPE_BYTE_ARRAY=Nt,e.BSON_BINARY_SUBTYPE_DEFAULT=St,e.BSON_BINARY_SUBTYPE_FUNCTION=mt,e.BSON_BINARY_SUBTYPE_MD5=Ot,e.BSON_BINARY_SUBTYPE_USER_DEFINED=Bt,e.BSON_BINARY_SUBTYPE_UUID=bt,e.BSON_BINARY_SUBTYPE_UUID_NEW=_t,e.BSON_DATA_ARRAY=gt,e.BSON_DATA_BINARY=yt,e.BSON_DATA_BOOLEAN=dt,e.BSON_DATA_CODE=pt,e.BSON_DATA_CODE_W_SCOPE=ht,e.BSON_DATA_DATE=ct,e.BSON_DATA_DBPOINTER=lt,e.BSON_DATA_DECIMAL128=at,e.BSON_DATA_INT=ft,e.BSON_DATA_LONG=st,e.BSON_DATA_MAX_KEY=ut,e.BSON_DATA_MIN_KEY=ot,e.BSON_DATA_NULL=it,e.BSON_DATA_NUMBER=nt,e.BSON_DATA_OBJECT=rt,e.BSON_DATA_OID=tt,e.BSON_DATA_REGEXP=et,e.BSON_DATA_STRING=Qe,e.BSON_DATA_SYMBOL=Ze,e.BSON_DATA_TIMESTAMP=Ge,e.BSON_DATA_UNDEFINED=We,e.BSON_INT32_MAX=Xe,e.BSON_INT32_MIN=He,e.BSON_INT64_MAX=Ke,e.BSON_INT64_MIN=Ve,e.Binary=Ce,e.Code=Je,e.DBRef=ze,e.Decimal128=De,e.Double=Le,e.EJSON=Fe,e.Int32=Re,e.Long=Me,e.LongWithoutOverridesClass=qe,e.Map=ke,e.MaxKey=xe,e.MinKey=Ue,e.ObjectID=Te,e.ObjectId=Ye,e.Timestamp=je,e.UUID=Pe,e.calculateObjectSize=At,e.default=Ee,e.deserialize=wt,e.deserializeStream=vt,e.serialize=Tt,e.serializeWithBufferAndIndex=Et,e.setInternalBufferSize=Dt,e.BufferPolyfill=b.Buffer,Object.defineProperty(e,"__esModule",{value:!0}),e}({});(()=>{const e=!("undefined"==typeof window);if(e&&window.HotPocket)return;if(!e){const e=require("util");TextEncoder=e.TextEncoder,TextDecoder=e.TextDecoder}const t="0.6.",r=237,n=new TextEncoder,i=new TextDecoder;let o=null,u=null,s=null,f=null,a=0;const l={json:"json",bson:"bson"};Object.freeze(l);const c={disconnect:"disconnect",contractOutput:"contract_output",connectionChange:"connection_change",unlChange:"unl_change",ledgerEvent:"ledger_event",healthEvent:"health_event"};Object.freeze(c);const h={unlChange:"unl_change",ledgerEvent:"ledger_event",healthEvent:"health_event"};Object.freeze(h);const p=async(e=null)=>{if(await N(),e){const t=b(e);if(t[0]!=r)throw"Invaid key type. 'ed' expected.";const n=new Uint8Array(33);return n[0]=r,n.set(t.slice(33),1),{privateKey:t,publicKey:n}}{const e=u.crypto_sign_keypair(),t=new Uint8Array(65);t[0]=r,t.set(e.privateKey,1);const n=new Uint8Array(33);return n[0]=r,n.set(e.publicKey,1),{privateKey:t,publicKey:n}}},d=async(t,r,n)=>{const i={contractId:null,contractVersion:null,trustedServerKeys:null,protocol:l.json,requiredConnectionCount:1,connectionTimeoutMs:5e3},u=n?{...i,...n}:i;if(!r)throw"clientKeys not specified.";if(""==u.contractId)throw"contractId not specified. Specify null to bypass contract id validation.";if(""==u.contractVersion)throw"contractVersion not specified. Specify null to bypass contract version validation.";if(!u.protocol||u.protocol!=l.json&&u.protocol!=l.bson)throw"Valid protocol not specified.";if(!u.requiredConnectionCount||0==u.requiredConnectionCount)throw"requiredConnectionCount must be greater than 0.";if(!u.connectionTimeoutMs||0==u.connectionTimeoutMs)throw"Connection timeout must be greater than 0.";await N(),await async function(){if(f)return;if(e&&window.blake3)f=window.blake3;else{if(e&&!window.blake3)return A||(A=new Promise((e=>{"undefined"==typeof BigUint64Array&&(BigUint64Array=function(e){}),"undefined"==typeof BigInt&&(BigInt=function(e){});import("https://cdn.jsdelivr.net/npm/blake3@2.1.4/browser-async.js").then((t=>{t.default().then((t=>{f=t,e()})).catch((t=>{console.error(t),e()}))})).catch((t=>{console.error(t),e()}))}))),void await A;e||(f=require("blake3"))}if(!f)throw"Blake3 reference not found."}(),function(){if(o)return;e&&window.WebSocket?o=window.WebSocket:e||(o=require("ws"));if(!o)throw"WebSocket reference not found."}(),u.protocol==l.bson&&await async function(){if(s)return;e?(v||(v=new Promise((e=>{setTimeout((()=>{s=window.BSON,window.Buffer=window.BSON.BufferPolyfill,e()}),0)}))),await v):e||(s=require("bson"));if(!s)throw"BSON reference not found."}();const a={};if(t&&t.forEach((e=>{const t=e.trim();t.length>0&&(a[t]=!0)})),0==Object.keys(a).length)throw"servers not specified.";if(u.requiredConnectionCount>Object.keys(a).length)throw"requiredConnectionCount is higher than no. of servers.";let c={};return u.trustedServerKeys&&u.trustedServerKeys.sort().forEach((e=>{const t=e.trim();t.length>0&&(c[t]=!0)})),0==Object.keys(c).length&&(c=null),new y(u.contractId,u.contractVersion,r,a,c,u.protocol,u.requiredConnectionCount,u.connectionTimeoutMs)};function y(e,t,r,n,i,o,u,s){let f=new S;const a=()=>i,l=e=>i=e,p=Object.keys(n).map((e=>({server:e,connection:null,lastActivity:0}))),d={};d[h.unlChange]=!!i,d[h.ledgerEvent]=!1,d[h.healthEvent]=!1;let y=0,_=null,b=0,B=null;const O=()=>{if(2==y)return;if(B=setTimeout((()=>{O()}),1e3),p.filter((e=>e.connection&&e.connection.isConnected())).length==u)return b=0,_&&_(!0),_=null,void(y=1);if(0==b)b=(new Date).getTime();else if((new Date).getTime()-b>s)return E(1,"Missing-connections timeout reached."),void this.close().then((()=>{_?(_(!1),_=null):f&&f.emit(c.disconnect)}));let n=p.filter((e=>e.connection)).length;if(n==u)return;const i=p.filter((e=>!e.connection&&(new Date).getTime()-e.lastActivity>3e3));for(i.sort(((e,t)=>e.lastActivity-t.lastActivity));n<u&&i.length>0;){const u=i.shift();u.connection=new g(e,t,r,u.server,a,l,o,s,f),u.lastActivity=(new Date).getTime(),u.connection.connect().then((e=>{if(e){f&&f.emit(c.connectionChange,u.server,"add");for(const[e,t]of Object.entries(d))t&&u.connection.subscribe(e)}else u.connection=null})),u.connection.onClose=()=>{u.connection=null,f&&f.emit(c.connectionChange,u.server,"remove")},n++}},m=async(e,t)=>{if(2==y)return await Promise.resolve();null==t&&(t=u);const r=p.filter((e=>e.connection&&e.connection.isConnected())).map((e=>e.connection)).slice(0,t),n=await Promise.all(r.map((t=>e(t))));return 1==t&&n.length<=1?0==n.length?null:n[0]:n},N=(e,t)=>{if(2==y)return Promise.resolve();null==t&&(t=u);const r=p.filter((e=>e.connection&&e.connection.isConnected())).map((e=>e.connection)).slice(0,t);return Promise.all(r.map((t=>e(t))))};this.connect=()=>{if(!(y>0))return b=(new Date).getTime(),O(),new Promise((e=>{_=e}))},this.close=async()=>{2!=y&&(y=2,B&&(clearTimeout(B),B=null),f.clear(c.connectionChange),f.clear(c.contractOutput),await Promise.all(p.filter((e=>e.connection)).map((e=>e.connection.close()))),p.forEach((e=>e.connection=null)))},this.on=(e,t)=>{f.on(e,t)},this.clear=e=>{f.clear(e)},this.submitContractInput=(e,t=null,r=null,n=!0)=>m((i=>i.submitContractInput(e,t,r,n)),1),this.submitContractReadRequest=(e,t=null,r=15e3)=>(t=t?t.toString():(new Date).getTime().toString(),m((n=>n.submitContractReadRequest(e,t,r)))),this.getStatus=()=>m((e=>e.getStatus())),this.getLcl=()=>m((e=>e.getLcl())),this.subscribe=e=>(d[e]=!0,N((t=>t.subscribe(e)))),this.unsubscribe=e=>(d[e]=!1,N((t=>t.unsubscribe(e)))),this.getLedgerBySeqNo=(e,t,r)=>m((n=>n.getLedgerBySeqNo(e,t,r)))}function g(r,s,a,h,p,d,y,g,S){const N=new _(a,l.json);let v=0,A=null,w=null,T=null,D=!1,I=null,x=null,U=null,R=null,L=[],j=[],M={},P={},Y={};const C=e=>{const t=f.createHash();return e.forEach((e=>t.update(e))),new Uint8Array(t.digest())},z=(e,t)=>{const r=[];let n=!1;for(let i of e)if(Array.isArray(i)){const e=z(i,n?null:t);1==e[0]&&(n=!0),r.push(e[1])}else{if(!t&&!i)return E(1,"Self hash encountered more than once in output hash tree."),[!1,null];i||(n=!0);const e=i?N.binaryDecode(i):t;r.push(e)}return[n,C(r)]},$=(e,t)=>{const r=C([a.publicKey,...N.spreadArrayField(e.outputs)]);if(!function(e,t){if(e.length!=t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(r,N.binaryDecode(e.output_hash)))return E(1,"Contract output hash mismatch."),!1;const n=z(e.hash_tree,r);if(1==n[0]){return((e,t,r)=>{const n=Object.keys(r).length;if(0==n)return E(1,"Cannot validate outputs with empty unl."),!1;const i={};for(pair of t){const t=N.stringifyValue(pair[0]),n=N.binaryDecode(pair[0]),o=N.binaryDecode(pair[1]);!i[t]&&r[t]&&u.crypto_sign_verify_detached(o,e,n.slice(1))&&(i[t]=!0)}return Object.keys(i).length/n>=.8})(n[1],e.unl_sig,t)}return!1},k=(e,t)=>{e=e.map((e=>N.deserializeValue(e))).sort();let r=p();if(r&&r[D]){r={};e.map((e=>N.stringifyValue(e))).forEach((e=>r[e]=!0)),d(r),E(0,"Updated trusted keys.")}t||S&&S.emit(c.unlChange,e)},J=async n=>{const o=e&&(v<2||y==l.json)?i.decode(n.data):n.data;try{m=N.deserializeMessage(o)}catch(e){return E(1,e),E(0,"Exception deserializing: "),E(0,o||n),void(v<2&&this.close())}let f=!1;v<2?f=(e=>{if(0==v&&"user_challenge"==e.type&&e.hp_version&&e.contract_id){if(!e.hp_version.startsWith(t))return E(1,`Incompatible Hot Pocket server version. Expected:0.6.* Got:${e.hp_version}`),!1;if(!e.contract_id)return E(1,"Server did not specify contract id."),!1;if(r&&e.contract_id!=r)return E(1,`Contract id mismatch. Expected:${r} Got:${e.contract_id}`),!1;if(!e.contract_version)return E(1,"Server did not specify contract version."),!1;if(s&&e.contract_version!=s)return E(1,`Contract version mismatch. Expected:${s} Got:${e.contract_version}`),!1;w=e.contract_id,T=e.contract_version,A=B(u.randombytes_buf(16));const n=N.createUserChallengeResponse(e.challenge,A,y);return K(N.serializeObject(n)),v=1,!0}if(1==v&&A&&"server_challenge_response"==e.type&&e.sig&&e.pubkey){const t=p();if(t&&!t[e.pubkey])return E(1,`${h} is not among the trusted servers.`),!1;const r=A+w+T,n=e.pubkey.substring(2);return u.crypto_sign_verify_detached(b(e.sig),r,b(n))?(clearTimeout(x),x=null,A=null,D=e.pubkey,v=2,k(e.unl,!0),N.useProtocol(y),U&&U(!0),E(0,`Connected to ${h}`),!0):(E(1,`${h} challenge response verification failed.`),!1)}return E(1,`${h} invalid message during handshake. Connection status:${v}`),E(0,e),!1})(m):2==v&&(f=(e=>{if("contract_read_response"==e.type){const t=e.reply_for,r=P[t];r&&(clearTimeout(r.timer),r.resolver(N.deserializeValue(e.content)),delete P[t])}else if("contract_input_status"==e.type){const t=N.stringifyValue(e.input_hash),r=M[t];if(r){const n={status:e.status};"accepted"==e.status?(n.ledgerSeqNo=e.ledger_seq_no,n.ledgerHash=N.deserializeValue(e.ledger_hash)):n.reason=e.reason,r(n),delete M[t]}}else if("contract_output"==e.type){if(S){const t=p();!t||$(e,t)?S.emit(c.contractOutput,{ledgerSeqNo:e.ledger_seq_no,ledgerHash:N.deserializeValue(e.ledger_hash),outputHash:N.deserializeValue(e.output_hash),outputs:e.outputs.map((e=>N.deserializeValue(e)))}):E(1,"Output validation failed.")}}else if("stat_response"==e.type)L.forEach((t=>{t({hpVersion:e.hp_version,ledgerSeqNo:e.ledger_seq_no,ledgerHash:N.deserializeValue(e.ledger_hash),voteStatus:e.vote_status,roundTime:e.round_time,contractExecutionEnabled:e.contract_execution_enabled,readRequestsEnabled:e.read_requests_enabled,isFullHistoryNode:e.is_full_history_node,weaklyConnected:e.weakly_connected,currentUnl:e.current_unl.map((e=>N.deserializeValue(e))),peers:e.peers})})),L=[];else if("lcl_response"==e.type)j.forEach((t=>{t({ledgerSeqNo:e.ledger_seq_no,ledgerHash:N.deserializeValue(e.ledger_hash)})})),j=[];else if("unl_change"==e.type)k(e.unl,!1);else if("ledger_event"==e.type){const t={event:e.event};"ledger_created"==t.event?t.ledger=N.deserializeLedger(e.ledger):"vote_status"==t.event&&(t.voteStatus=e.vote_status),S.emit(c.ledgerEvent,t)}else if("health_event"==e.type){const t=N.deserializeHealthEvent(e);S.emit(c.healthEvent,t)}else{if("ledger_query_result"!=e.type)return E(1,"Received unrecognized contract message: type:"+e.type),!1;{const t=Y[e.reply_for];if(t){const r=e.results.map((e=>{const t=N.deserializeLedger(e);return e.inputs&&(t.inputs=e.inputs.map((e=>({pubkey:N.deserializeValue(e.pubkey),hash:N.deserializeValue(e.hash),nonce:e.nonce,blob:N.deserializeValue(e.blob)})))),e.outputs&&(t.outputs=e.outputs.map((e=>({pubkey:N.deserializeValue(e.pubkey),hash:N.deserializeValue(e.hash),blobs:e.blobs.map((e=>N.deserializeValue(e)))})))),t}));"seq_no"==t.type&&t.resolver(r.length>0?r[0]:null),delete Y[e.reply_for]}}}return!0})(m)),f||v<2&&this.close()},q=()=>{I.addEventListener("message",J),I.addEventListener("close",F),x=setTimeout((()=>{this.close(),x=null}),g)},F=()=>{E(0,R?"Closing connection to "+h:"Disconnected from "+h),S=null,x&&(clearTimeout(x),x=null),U&&U(!1),U=null,L.forEach((e=>e(null))),L=[],Object.values(M).forEach((e=>e({status:"failed",reason:"connection_error"}))),M={},Object.values(P).forEach((e=>{clearTimeout(e.timer),e.resolver(null)})),P={},this.onClose&&this.onClose(),R&&R()},V=e=>{U&&U(!1)},K=e=>{O(e)?I.send(n.encode(e)):I.send(e)};this.isConnected=()=>2==v,this.connect=()=>(E(0,"Connecting to "+h),new Promise((t=>{I=e?new o(h):new o(h,{rejectUnauthorized:!1}),e&&(I.binaryType="arraybuffer"),U=t,I.addEventListener("error",V),I.addEventListener("open",q)}))),this.close=()=>I.readyState==o.OPEN?new Promise((e=>{R=e,I.close()})):(I.close(),Promise.resolve()),this.getStatus=()=>{if(2!=v)return Promise.resolve(null);const e=new Promise((e=>{L.push(e)}));if(1==L.length){const e=N.createStatusRequest();K(N.serializeObject(e))}return e},this.getLcl=()=>{if(2!=v)return Promise.resolve(null);const e=new Promise((e=>{j.push(e)}));if(1==j.length){const e=N.createLclRequest();K(N.serializeObject(e))}return e},this.submitContractInput=async(e,t,r,n)=>{if(2!=v)throw"Connection error.";if(0==r)throw"Max ledger seq no. or offset cannot be 0.";if(!n&&!r)throw"Max ledger seq. no not specified.";if(t&&(!Number.isInteger(t)||t<=0))throw"Input nonce must be a positive integer.";if(t||(t=(new Date).getTime()),n){r||(r=10);const e=await this.getLcl();if(!e)throw"Error retrieving last closed ledger.";r+=e.ledgerSeqNo}const i=N.createContractInputComponents(e,t,r),o=N.stringifyValue(i.hash),u=new Promise((e=>{M[o]=e})),s=N.createContractInputMessage(i.container,i.sig);return K(N.serializeObject(s)),{hash:N.binaryEncode(i.hash),submissionStatus:u}},this.submitContractReadRequest=(e,t,r)=>2!=v?Promise.resolve():new Promise((n=>{const i=setTimeout((()=>{n(null),delete P[t]}),r);P[t]={resolver:n,timer:i};const o=N.createReadRequest(e,t);K(N.serializeObject(o))})),this.subscribe=e=>{if(2!=v)return Promise.resolve();const t=N.createSubscriptionRequest(e,!0);return K(N.serializeObject(t)),Promise.resolve()},this.unsubscribe=e=>{if(2!=v)return Promise.resolve();const t=N.createSubscriptionRequest(e,!1);return K(N.serializeObject(t)),Promise.resolve()},this.getLedgerBySeqNo=(e,t,r)=>{if(2!=v)return Promise.resolve(null);const n={seq_no:N.serializeNumber(e)},i=N.createLedgerQuery("seq_no",n,t,r),o=new Promise((e=>{Y[i.id]={type:"seq_no",resolver:e}}));return K(N.serializeObject(i)),o}}function _(e,t){this.useProtocol=e=>{t=e},this.binaryEncode=e=>t==l.json?B(e):Buffer.isBuffer(e)?e:Buffer.from(e),this.binaryDecode=e=>t==l.json?b(e):new Uint8Array(e.buffer),this.serializeObject=e=>t==l.json?JSON.stringify(e):s.serialize(e),this.deserializeMessage=e=>t==l.json?JSON.parse(e):s.deserialize(e),this.serializeInput=e=>t==l.json?O(e)?e:e.toString():Buffer.isBuffer(e)?e:Buffer.from(e),this.deserializeValue=e=>t==l.json?e:e.buffer,this.serializeNumber=e=>t==l.json?e:s.Long.fromNumber(e),this.stringifyValue=e=>{if(O(e))return e;if(e instanceof Uint8Array)return B(e);if(e.buffer)return B(new Uint8Array(e.buffer));throw"Cannot stringify signature."},this.spreadArrayField=e=>t==l.json?e:e.map((e=>e.buffer)),this.createUserChallengeResponse=(t,r,n)=>{const i=u.crypto_sign_detached(t,e.privateKey.slice(1));return{type:"user_challenge_response",sig:this.binaryEncode(i),pubkey:this.binaryEncode(e.publicKey),server_challenge:r,protocol:n}},this.createContractInputComponents=(t,r,n)=>{if(0==t.length)return null;const i={input:this.serializeInput(t),nonce:this.serializeNumber(r),max_ledger_seq_no:this.serializeNumber(n)},o=this.serializeObject(i),s=u.crypto_sign_detached(o,e.privateKey.slice(1));return{hash:new Uint8Array(f.hash(s)),container:o,sig:s}},this.createContractInputMessage=(e,t)=>({type:"contract_input",input_container:e,sig:this.binaryEncode(t)}),this.createReadRequest=(e,t)=>0==e.length?null:{type:"contract_read_request",id:t,content:this.serializeInput(e)},this.createStatusRequest=()=>({type:"stat"}),this.createLclRequest=()=>({type:"lcl"}),this.createSubscriptionRequest=(e,t)=>({type:"subscription",channel:e,enabled:t}),this.createLedgerQuery=(e,t,r,n)=>{const i=[];return r&&i.push("inputs"),n&&i.push("outputs"),{type:"ledger_query",id:"query_"+e+"_"+(new Date).getTime().toString(),filter_by:e,params:t,include:i}},this.deserializeLedger=e=>({seqNo:e.seq_no,timestamp:e.timestamp,hash:this.deserializeValue(e.hash),prevHash:this.deserializeValue(e.prev_hash),stateHash:this.deserializeValue(e.state_hash),configHash:this.deserializeValue(e.config_hash),userHash:this.deserializeValue(e.user_hash),inputHash:this.deserializeValue(e.input_hash),outputHash:this.deserializeValue(e.output_hash)}),this.deserializeHealthEvent=e=>"proposal"===e.event?{event:e.event,commLatency:e.comm_latency,readLatency:e.read_latency,batchSize:e.batch_size}:"connectivity"===e.event?{event:e.event,peerCount:e.peer_count,weaklyConnected:e.weakly_connected}:void 0}function b(e){return new Uint8Array(e.match(/.{1,2}/g).map((e=>parseInt(e,16))))}function B(e){return e.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),"")}function O(e){return"string"==typeof e||e instanceof String}function S(){const e={};this.on=(t,r)=>{e[t]||(e[t]=[]),e[t].push(r)},this.emit=(t,...r)=>{e[t]&&e[t].forEach((e=>e(...r)))},this.clear=t=>{t?delete e[t]:Object.keys(e).forEach((t=>delete e[t]))}}async function N(){if(e?u||(u=window.sodium||await new Promise((e=>{window.sodium={onload:async t=>e(t)}}))):(u||(u=require("libsodium-wrappers")),await u.ready),!u)throw"Sodium reference not found. Please include sodium js lib in browser scripts."}let v=null;let A=null;function w(e){a=e}function E(e,t){e>=a&&console.log(t)}e?window.HotPocket={generateKeys:p,createClient:d,events:c,notificationChannels:h,protocols:l,setLogLevel:w}:module.exports={generateKeys:p,createClient:d,events:c,notificationChannels:h,protocols:l,setLogLevel:w}})();
